---
permalink: troubleshoot/verifying-object-integrity.html 
sidebar: sidebar 
keywords: how to verify object integrity, object existence check, background verification 
summary: StorageGRIDシステムは、ストレージ ノード上のオブジェクト データの整合性を検証し、破損したオブジェクトと欠落したオブジェクトの両方をチェックします。 
---
= オブジェクトの整合性を検証する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
StorageGRIDシステムは、ストレージ ノード上のオブジェクト データの整合性を検証し、破損したオブジェクトと欠落したオブジェクトの両方をチェックします。

検証プロセスには、バックグラウンド検証とオブジェクト存在チェック (以前はフォアグラウンド検証と呼ばれていました) の 2 つがあります。これらは連携してデータの整合性を確保します。バックグラウンド検証は自動的に実行され、オブジェクト データの正確性を継続的にチェックします。オブジェクトの存在チェックは、ユーザーがトリガーして、オブジェクトの存在（正確性ではない）をより迅速に検証することができます。



== 身元確認とは何ですか?

バックグラウンド検証プロセスでは、ストレージ ノードにオブジェクト データの破損したコピーがないか自動的に継続的にチェックし、見つかった問題を自動的に修復しようとします。

バックグラウンド検証では、次のように、複製されたオブジェクトと消去コード化されたオブジェクトの整合性をチェックします。

* *複製されたオブジェクト*: バックグラウンド検証プロセスで破損した複製されたオブジェクトが見つかった場合、破損したコピーはその場所から削除され、ストレージ ノード上の別の場所に隔離されます。次に、アクティブな ILM ポリシーを満たすように、破損していない新しいコピーが生成されて配置されます。新しいコピーは、元のコピーに使用されたストレージ ノードに配置されない可能性があります。



NOTE: 破損したオブジェクト データはシステムから削除されるのではなく隔離されるため、引き続きアクセスできます。隔離されたオブジェクト データへのアクセスの詳細については、テクニカル サポートにお問い合わせください。

* *消去コード化オブジェクト*: バックグラウンド検証プロセスで消去コード化オブジェクトのフラグメントが破損していることが検出されると、 StorageGRID は残りのデータ フラグメントとパリティ フラグメントを使用して、同じストレージ ノード上で失われたフラグメントを自動的に再構築しようとします。破損したフラグメントを再構築できない場合は、オブジェクトの別のコピーを取得しようとします。取得が成功した場合、ILM 評価が実行され、消失訂正符号化オブジェクトの置換コピーが作成されます。
+
バックグラウンド検証プロセスでは、ストレージ ノード上のオブジェクトのみがチェックされます。クラウド ストレージ プール内のオブジェクトはチェックされません。背景検証の対象となるには、オブジェクトは 4 日以上経過している必要があります。



バックグラウンド検証は、通常のシステム アクティビティを妨げないように設計された継続的な速度で実行されます。背景検証を停止することはできません。ただし、問題が疑われる場合は、バックグラウンド検証レートを上げて、ストレージ ノードの内容をより迅速に検証することができます。



=== 身元調査に関するアラート

システムが自動的に修正できない破損したオブジェクトを検出した場合 (破損によってオブジェクトを識別できないため)、*識別されていない破損したオブジェクトが検出されました* というアラートがトリガーされます。

バックグラウンド検証で別のコピーが見つからないために破損したオブジェクトを置き換えることができない場合は、「オブジェクトが失われました」というアラートがトリガーされます。



=== 背景検証率を変更する

データの整合性に懸念がある場合は、バックグラウンド検証がストレージ ノード上の複製されたオブジェクト データをチェックする頻度を変更できます。

.開始する前に
* グリッドマネージャにサインインするには、link:../admin/web-browser-requirements.html["サポートされているウェブブラウザ"] 。
* あなたが持っているlink:../admin/admin-group-permissions.html["特定のアクセス権限"]。


.タスク概要
ストレージ ノードのバックグラウンド検証の検証レートを変更できます。

* アダプティブ: デフォルト設定。タスクは、最大 4 MB/秒または 10 オブジェクト/秒 (いずれか早い方) で検証するように設計されています。
* 高: ストレージ検証は高速で進行しますが、その速度によって通常のシステム アクティビティが遅くなる可能性があります。


ハードウェアまたはソフトウェアの障害によってオブジェクト データが破損した可能性がある場合にのみ、高検証率を使用してください。高優先度のバックグラウンド検証が完了すると、検証レートは自動的に「適応型」にリセットされます。

.手順
. *サポート* > *ツール* > *グリッド トポロジ* を選択します。
. *_Storage Node_* > *LDR* > *検証*を選択します。
. *構成* > *メイン*を選択します。
. *LDR* > *検証* > *構成* > *メイン* に移動します。
. [バックグラウンド検証] で、[検証率] > [高] または [検証率] > [適応型] を選択します。
+
image::../media/background_verification_rate.png[検証率の設定]

. *変更を適用*をクリックします。
. 複製されたオブジェクトのバックグラウンド検証の結果を監視します。
+
.. *NODES* > *_Storage Node_* > *Objects* に移動します。
.. 検証セクションで、*破損したオブジェクト*と*識別されていない破損オブジェクト*の値を監視します。
+
バックグラウンド検証で破損した複製オブジェクト データが見つかった場合、*破損オブジェクト* メトリックが増加し、 StorageGRID は次のようにデータからオブジェクト識別子を抽出しようとします。

+
*** オブジェクト識別子を抽出できる場合、 StorageGRID はオブジェクト データの新しいコピーを自動的に作成します。新しいコピーは、アクティブな ILM ポリシーを満たすStorageGRIDシステム内の任意の場所に作成できます。
*** オブジェクト識別子を抽出できない場合 (破損しているため) は、*識別されていない破損オブジェクト* メトリックが増加し、*識別されていない破損オブジェクトが検出されました* アラートがトリガーされます。


.. 破損したレプリケートされたオブジェクト データが見つかった場合は、テクニカル サポートに連絡して破損の根本原因を特定してください。


. 消去コード化されたオブジェクトのバックグラウンド検証の結果を監視します。
+
バックグラウンド検証で、消去コード化されたオブジェクト データの破損したフラグメントが見つかった場合、Corrupt Fragments Detected 属性が増加します。  StorageGRID は、破損したフラグメントを同じストレージ ノード上で再構築することで回復します。

+
.. *サポート* > *ツール* > *グリッド トポロジ* を選択します。
.. *_Storage Node_* > *LDR* > *Erasure Coding* を選択します。
.. 検証結果テーブルで、破損したフラグメントの検出 (ECCD) 属性を監視します。


. 破損したオブジェクトがStorageGRIDシステムによって自動的に復元された後、破損したオブジェクトの数をリセットします。
+
.. *サポート* > *ツール* > *グリッド トポロジ* を選択します。
.. *_Storage Node_* > *LDR* > *検証* > *構成* を選択します。
.. *破損したオブジェクトの数をリセット*を選択します。
.. *変更を適用*をクリックします。


. 隔離されたオブジェクトが不要であると確信できる場合は、削除できます。
+

NOTE: *オブジェクトが失われました*アラートがトリガーされた場合、テクニカル サポートは、根本的な問題のデバッグやデータ復旧を試みるために、隔離されたオブジェクトにアクセスする場合があります。

+
.. *サポート* > *ツール* > *グリッド トポロジ* を選択します。
.. *_Storage Node_* > *LDR* > *検証* > *構成* を選択します。
.. *隔離されたオブジェクトの削除*を選択します。
.. *変更を適用*を選択します。






== オブジェクト存在チェックとは何ですか?

オブジェクト存在チェックは、オブジェクトの予想されるすべての複製コピーと消去コード化フラグメントがストレージ ノード上に存在するかどうかを確認します。オブジェクト存在チェックでは、オブジェクト データ自体が検証されるわけではありません (バックグラウンド検証で実行されます)。代わりに、特に最近のハードウェアの問題がデータの整合性に影響を与えている可能性がある場合に、ストレージ デバイスの整合性を検証する方法を提供します。

自動的に実行されるバックグラウンド検証とは異なり、オブジェクト存在チェック ジョブは手動で開始する必要があります。

オブジェクト存在チェックは、 StorageGRIDに保存されているすべてのオブジェクトのメタデータを読み取り、複製されたオブジェクトのコピーと消去コード化されたオブジェクト フラグメントの両方の存在を確認します。欠落したデータは次のように処理されます。

* *複製されたコピー*: 複製されたオブジェクト データのコピーが欠落している場合、 StorageGRID はシステム内の他の場所に保存されているコピーでそのコピーを自動的に置き換えようとします。ストレージ ノードは、既存のコピーに対して ILM 評価を実行し、別のコピーが欠落しているため、このオブジェクトに対して現在の ILM ポリシーが満たされていないことを判断します。システムのアクティブな ILM ポリシーを満たすように新しいコピーが生成され、配置されます。この新しいコピーは、失われたコピーが保存されていた場所と同じ場所に配置されない可能性があります。
* *消去コード化されたフラグメント*: 消去コード化されたオブジェクトのフラグメントが欠落している場合、 StorageGRID は残りのフラグメントを使用して、同じストレージ ノード上で欠落しているフラグメントを自動的に再構築しようとします。失われたフラグメントを再構築できない場合 (フラグメントが多すぎるため)、ILM はオブジェクトの別のコピーを見つけようとします。このコピーを使用して、新しい消失訂正符号化フラグメントを生成できます。




=== オブジェクトの存在チェックを実行する

一度に 1 つのオブジェクト存在チェック ジョブを作成して実行します。ジョブを作成するときに、検証するストレージ ノードとボリュームを選択します。ジョブの一貫性も選択します。

.開始する前に
* グリッドマネージャにサインインするには、link:../admin/web-browser-requirements.html["サポートされているウェブブラウザ"] 。
* あなたはlink:../admin/admin-group-permissions.html["メンテナンスまたはルートアクセス権限"]。
* 確認するストレージ ノードがオンラインであることを確認しました。ノードのテーブルを表示するには、「*NODES*」を選択します。確認するノードのノード名の横にアラート アイコンが表示されていないことを確認します。
* 確認するノードで以下の手順が実行されていないことを確認しました。
+
** ストレージノードを追加するためのグリッド拡張
** ストレージノードの廃止
** 障害が発生したストレージボリュームの回復
** システムドライブに障害が発生したストレージノードの復旧
** ECの再均衡
** アプライアンスノードのクローン




これらの手順の進行中は、オブジェクトの存在チェックでは有用な情報は提供されません。

.タスク概要
オブジェクト存在チェック ジョブは、グリッド内のオブジェクトの数、選択したストレージ ノードとボリューム、および選択した一貫性に応じて、完了するまでに数日または数週間かかる場合があります。一度に実行できるジョブは 1 つだけですが、複数のストレージ ノードとボリュームを同時に選択できます。

.手順
. *メンテナンス* > *タスク* > *オブジェクト存在チェック*を選択します。
. *ジョブの作成*を選択します。オブジェクト存在チェックジョブの作成ウィザードが表示されます。
. 検証するボリュームを含むノードを選択します。すべてのオンライン ノードを選択するには、列ヘッダーの *ノード名* チェックボックスをオンにします。
+
ノード名またはサイトで検索できます。

+
グリッドに接続されていないノードを選択することはできません。

. *続行*を選択します。
. リスト内の各ノードに対して 1 つ以上のボリュームを選択します。ストレージ ボリューム番号またはノード名を使用してボリュームを検索できます。
+
選択した各ノードのすべてのボリュームを選択するには、列ヘッダーの *ストレージ ボリューム* チェックボックスをオンにします。

. *続行*を選択します。
. ジョブの一貫性を選択します。
+
一貫性により、オブジェクトの存在チェックに使用されるオブジェクト メタデータのコピーの数が決まります。

+
** *強力なサイト*: 単一のサイトにメタデータのコピーが 2 つあります。
** *強力なグローバル*: 各サイトにメタデータのコピーが 2 つあります。
** *すべて* (デフォルト): 各サイトのメタデータの 3 つのコピーすべて。
+
一貫性の詳細については、ウィザードの説明を参照してください。



. *続行*を選択します。
. 選択内容を確認して検証します。  「*前へ*」を選択すると、ウィザードの前のステップに戻り、選択内容を更新できます。
+
オブジェクト存在チェック ジョブが生成され、次のいずれかが発生するまで実行されます。

+
** ジョブが完了します。
** ジョブを一時停止またはキャンセルします。一時停止したジョブは再開できますが、キャンセルしたジョブは再開できません。
** 仕事は行き詰まる。 *オブジェクトの存在チェックが停止しました*アラートがトリガーされます。アラートに指定された是正措置に従ってください。
** ジョブは失敗します。 *オブジェクトの存在チェックに失敗しました*アラートがトリガーされます。アラートに指定された是正措置に従ってください。
** 「サービスは利用できません」または「内部サーバーエラー」というメッセージが表示されます。  1 分後にページを更新してジョブの監視を続行します。
+

NOTE: 必要に応じて、オブジェクト存在チェック ページから移動し、戻ってジョブの監視を続行できます。



. ジョブの実行中に、[*アクティブ ジョブ*] タブを表示し、[不足しているオブジェクトのコピーが検出されました] の値をメモします。
+
この値は、複製されたオブジェクトと、1 つ以上のフラグメントが欠落している消去コード化されたオブジェクトの欠落したコピーの合計数を表します。

+
検出された欠落オブジェクトのコピー数が 100 を超える場合、ストレージ ノードのストレージに問題がある可能性があります。

+
image::../media/oec_active.png[OECアクティブジョブ]

. ジョブが完了したら、必要な追加のアクションを実行します。
+
** 検出された欠落オブジェクトのコピーがゼロの場合、問題は見つかりませんでした。対処は不要です。
** 検出された欠落オブジェクトのコピー数が 0 より大きく、*オブジェクト損失* アラートがトリガーされていない場合、すべての欠落コピーはシステムによって修復されています。オブジェクトのコピーが将来損傷するのを防ぐために、ハードウェアの問題が修正されていることを確認します。
** 検出されたオブジェクトのコピーの不足数がゼロより大きく、*オブジェクトが失われました*アラートがトリガーされた場合、データの整合性が影響を受ける可能性があります。テクニカル サポートにお問い合わせください。
** grep を使用して LLST 監査メッセージを抽出することで、失われたオブジェクトのコピーを調査できます。 `grep LLST audit_file_name` 。
+
この手順は、link:../troubleshoot/investigating-lost-objects.html["紛失物の調査"]ただし、オブジェクトのコピーを検索する場合は、 `LLST`の代わりに `OLST`。



. ジョブに強力なサイト整合性または強力なグローバル整合性を選択した場合は、メタデータの整合性が確保されるまで約 3 週間待ってから、同じボリュームでジョブを再度実行します。
+
StorageGRID がジョブに含まれるノードとボリュームのメタデータの一貫性を実現する時間があった場合、ジョブを再実行すると、誤って報告された不足しているオブジェクト コピーがクリアされるか、不足しているオブジェクト コピーがある場合は追加のオブジェクト コピーがチェックされる可能性があります。

+
.. *メンテナンス* > *オブジェクト存在チェック* > *ジョブ履歴*を選択します。
.. 再実行の準備ができているジョブを判別します。
+
... *終了時刻*列を確認して、3 週間以上前に実行されたジョブを特定します。
... これらのジョブの場合、一貫性制御列で strong-site または strong-global をスキャンします。


.. 再実行する各ジョブのチェックボックスをオンにして、「再実行」を選択します。
+
image::../media/oec_rerun.png[OECの再放送]

.. ジョブの再実行ウィザードで、選択したノードとボリュームおよび一貫性を確認します。
.. ジョブを再実行する準備ができたら、「再実行」を選択します。




アクティブジョブタブが表示されます。選択したすべてのジョブは、strong-site の一貫性で 1 つのジョブとして再実行されます。詳細セクションの *関連ジョブ* フィールドには、元のジョブのジョブ ID がリストされます。

.終了後の操作
データの整合性について依然として懸念がある場合は、*サポート* > *ツール* > *グリッド トポロジ* > *_site_* > *_ストレージ ノード_* > *LDR* > *検証* > *構成* > *メイン* に移動して、バックグラウンド検証率を上げてください。バックグラウンド検証では、保存されているすべてのオブジェクト データの正確性を確認し、見つかった問題を修復します。潜在的な問題をできるだけ早く発見して修復することで、データ損失のリスクを軽減できます。
