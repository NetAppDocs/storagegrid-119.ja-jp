---
permalink: admin/managing-object-metadata-storage.html 
sidebar: sidebar 
keywords: object metadata, metadata capacity, best practices 
summary: StorageGRIDシステムのオブジェクト メタデータ容量は、そのシステムに保存できるオブジェクトの最大数を制御します。  StorageGRIDシステムに新しいオブジェクトを保存するための十分なスペースがあることを確認するには、 StorageGRID がオブジェクトのメタデータをどこにどのように保存するかを理解する必要があります。 
---
= オブジェクトメタデータストレージの管理
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
StorageGRIDシステムのオブジェクト メタデータ容量は、そのシステムに保存できるオブジェクトの最大数を制御します。  StorageGRIDシステムに新しいオブジェクトを保存するための十分なスペースがあることを確認するには、 StorageGRID がオブジェクトのメタデータをどこにどのように保存するかを理解する必要があります。



== オブジェクト メタデータとは何ですか?

オブジェクト メタデータは、オブジェクトを説明する情報です。  StorageGRID はオブジェクト メタデータを使用して、グリッド全体のすべてのオブジェクトの場所を追跡し、各オブジェクトのライフサイクルを長期にわたって管理します。

StorageGRID内のオブジェクトの場合、オブジェクト メタデータには次の種類の情報が含まれます。

* システム メタデータには、各オブジェクトの一意の ID (UUID)、オブジェクト名、S3 バケットの名前、テナント アカウント名または ID、オブジェクトの論理サイズ、オブジェクトが最初に作成された日時、オブジェクトが最後に変更された日時が含まれます。
* オブジェクトに関連付けられたカスタム ユーザー メタデータのキーと値のペア。
* S3 オブジェクトの場合、オブジェクトに関連付けられたオブジェクト タグのキーと値のペア。
* 複製されたオブジェクトのコピーの場合、各コピーの現在の保存場所。
* 消失訂正符号化オブジェクトのコピーの場合、各フラグメントの現在の保存場所。
* Cloud Storage プール内のオブジェクト コピーの場合、外部バケットの名前とオブジェクトの一意の識別子を含むオブジェクトの場所。
* セグメント化されたオブジェクトとマルチパート オブジェクトの場合、セグメント識別子とデータ サイズ。




== オブジェクト メタデータはどのように保存されますか?

StorageGRID は、オブジェクト データとは独立して保存される Cassandra データベースにオブジェクト メタデータを維持します。冗長性を提供し、オブジェクト メタデータの損失を防ぐために、 StorageGRID はシステム内のすべてのオブジェクトのメタデータのコピーを各サイトに 3 つ保存します。

この図は、2 つのサイトのストレージ ノードを表しています。各サイトには同じ量のオブジェクト メタデータがあり、各サイトのメタデータはそのサイトのすべてのストレージ ノード間で分割されます。

image::../media/metadata_space_across_sites.png[サイト間のメタデータ空間]



== オブジェクト メタデータはどこに保存されますか?

この図は、単一のストレージ ノードのストレージ ボリュームを表しています。

image::../media/metadata_space_storage_node.png[メタデータスペースストレージノード]

図に示すように、 StorageGRID は各ストレージ ノードのストレージ ボリューム 0 にオブジェクト メタデータ用のスペースを予約します。予約されたスペースを使用して、オブジェクトのメタデータを保存し、重要なデータベース操作を実行します。ストレージ ボリューム 0 およびストレージ ノード内の他のすべてのストレージ ボリュームの残りのスペースは、オブジェクト データ (複製されたコピーおよび消去コード化されたフラグメント) 専用に使用されます。

特定のストレージ ノード上のオブジェクト メタデータ用に予約されるスペースの量は、以下で説明するいくつかの要因によって異なります。



== メタデータ予約領域の設定

_メタデータ予約済みスペース_ は、各ストレージ ノードのボリューム 0 上のメタデータ用に予約されるスペースの量を表すシステム全体の設定です。表に示すように、この設定のデフォルト値は次のものに基づいています。

* StorageGRIDを最初にインストールしたときに使用していたソフトウェア バージョン。
* 各ストレージ ノード上の RAM の量。


[cols="1a,1a,1a"]
|===
| StorageGRIDの初期インストールに使用されるバージョン | ストレージノード上の RAM の量 | デフォルトのメタデータ予約領域設定 


 a| 
11.5～11.9
 a| 
グリッド内の各ストレージノードに128 GB以上
 a| 
8 TB (8,000 GB)



 a| 
 a| 
グリッド内のどのストレージノードでも 128 GB 未満
 a| 
3 TB (3,000 GB)



 a| 
11.1～11.4
 a| 
1 つのサイトの各ストレージ ノードに 128 GB 以上
 a| 
4 TB (4,000 GB)



 a| 
 a| 
各サイトのストレージノード上の容量が 128 GB 未満
 a| 
3 TB (3,000 GB)



 a| 
11.0以前
 a| 
任意の金額
 a| 
2 TB (2,000 GB)

|===


=== メタデータ予約領域設定の表示

StorageGRIDシステムのメタデータ予約領域設定を表示するには、次の手順に従います。

.手順
. *構成* > *システム* > *ストレージ設定*を選択します。
. ストレージ設定ページで、*メタデータ予約済み領域*セクションを展開します。


StorageGRID 11.8 以降の場合、メタデータ予約領域の値は 100 GB 以上 1 PB 以下である必要があります。

各ストレージ ノードに 128 GB 以上の RAM が搭載されているStorageGRID 11.6 以降の新規インストールのデフォルト設定は 8,000 GB (8 TB) です。



== メタデータ用に実際に予約されたスペース

システム全体のメタデータ予約済みスペース設定とは対照的に、オブジェクト メタデータの _実際の予約済みスペース_ はストレージ ノードごとに決定されます。特定のストレージ ノードの場合、メタデータ用に実際に予約される領域は、ノードのボリューム 0 のサイズとシステム全体のメタデータ予約領域の設定によって異なります。

[cols="1a,1a"]
|===
| ノードのボリューム0のサイズ | メタデータ用に実際に予約されたスペース 


 a| 
500 GB未満（非本番環境用）
 a| 
ボリューム0の10%



 a| 
500 GB以上+または+メタデータ専用ストレージノード
 a| 
これらの値のうち小さい方:

* 第0巻
* メタデータ予約領域の設定


*注*: メタデータのみのストレージ ノードに必要な rangedb は 1 つだけです。

|===


=== メタデータ用に実際に予約されているスペースを表示する

特定のストレージ ノード上のメタデータ用に実際に予約されている領域を表示するには、次の手順に従います。

.手順
. グリッド マネージャーから、*NODES* > *_Storage Node_* を選択します。
. *ストレージ*タブを選択します。
. 使用済みストレージ - オブジェクト メタデータ チャートの上にカーソルを置き、*実際の予約済み* の値を見つけます。
+
image::../media/storage_used_object_metadata_actual_reserved.png[使用済みストレージ - オブジェクトメタデータ - 実際の予約済み]



スクリーンショットでは、*実際の予約済み*の値は 8 TB です。このスクリーンショットは、新しいStorageGRID 11.6 インストール内の大規模なストレージ ノードのものです。システム全体のメタデータ予約済みスペース設定がこのストレージ ノードのボリューム 0 より小さいため、このノードの実際の予約済みスペースはメタデータ予約済みスペース設定と等しくなります。



== 実際に予約されたメタデータ空間の例

バージョン 11.7 以降を使用して新しいStorageGRIDシステムをインストールするとします。この例では、各ストレージ ノードに 128 GB を超える RAM があり、ストレージ ノード 1 (SN1) のボリューム 0 が 6 TB であると想定します。これらの値に基づきます:

* システム全体の*メタデータ予約領域*は 8 TB に設定されています。  (各ストレージ ノードに 128 GB を超える RAM がある場合、これはStorageGRID 11.6 以降の新規インストールのデフォルト値です。)
* SN1 のメタデータ用に実際に予約されているスペースは 6 TB です。  (ボリューム 0 は *メタデータ予約領域* の設定よりも小さいため、ボリューム全体が予約されます。)




== 許可されたメタデータスペース

各ストレージ ノードのメタデータ用に実際に予約されているスペースは、オブジェクト メタデータに使用可能なスペース (_許可されたメタデータ スペース_) と、基本的なデータベース操作 (圧縮や修復など) および将来のハードウェアとソフトウェアのアップグレードに必要なスペースに分割されます。許可されたメタデータ領域によって、オブジェクト全体の容量が決まります。

image::../media/metadata_allowed_space_volume_0.png[メタデータ許容スペースボリューム0]

次の表は、ノードのメモリ量とメタデータ用に実際に予約されたスペースに基づいて、 StorageGRID がさまざまなストレージ ノードの *許可されたメタデータ スペース* を計算する方法を示しています。

[cols="1a,1a,2a,2a"]
|===


 a| 
 a| 
 a| 
*ストレージノードのメモリ量*



 a| 
 a| 
 a| 
128 GB未満
 a| 
128 GB以上



 a| 
*メタデータ用に実際に予約されたスペース*
 a| 
4 TB 以上
 a| 
メタデータ用に実際に予約されているスペースの60%、最大1.32 TB
 a| 
メタデータ用に実際に予約されているスペースの60%、最大1.98 TB



 a| 
4TB以上
 a| 
（メタデータ用に実際に予約されている領域 − 1 TB） × 60%、最大1.32 TB
 a| 
（メタデータ用に実際に予約されている領域 − 1 TB） × 60%、最大3.96 TB

|===


=== 許可されたメタデータスペースを表示

ストレージ ノードに許可されているメタデータ領域を表示するには、次の手順に従います。

.手順
. グリッド マネージャーから、*NODES* を選択します。
. ストレージ ノードを選択します。
. *ストレージ*タブを選択します。
. 使用済みストレージ - オブジェクト メタデータ チャートの上にカーソルを置き、*許可* 値を見つけます。
+
image::../media/storage_used_object_metadata_allowed.png[使用済みストレージ - オブジェクトメタデータ - 許可]



スクリーンショットでは、「許可された」値は 3.96 TB です。これは、メタデータ用に実際に予約されたスペースが 4 TB を超えるストレージ ノードの最大値です。

*Allowed* 値は、次の Prometheus メトリックに対応します。

`storagegrid_storage_utilization_metadata_allowed_bytes`



== 許可されたメタデータスペースの例

バージョン 11.6 を使用してStorageGRIDシステムをインストールするとします。この例では、各ストレージ ノードに 128 GB を超える RAM があり、ストレージ ノード 1 (SN1) のボリューム 0 が 6 TB であると想定します。これらの値に基づきます:

* システム全体の*メタデータ予約領域*は 8 TB に設定されています。  (これは、各ストレージ ノードに 128 GB を超える RAM がある場合のStorageGRID 11.6 以降のデフォルト値です。)
* SN1 のメタデータ用に実際に予約されているスペースは 6 TB です。  (ボリューム 0 は *メタデータ予約領域* の設定よりも小さいため、ボリューム全体が予約されます。)
* SN1のメタデータに許容されるスペースは、以下の計算に基づいて3TBです。<<table-allowed-space-for-metadata,メタデータに許可されたスペースの表>> : (メタデータ用に実際に予約されている領域 - 1 TB) × 60%、最大 3.96 TB。




== 異なるサイズのストレージノードがオブジェクト容量に与える影響

前述のように、 StorageGRID は各サイトのストレージ ノード全体にオブジェクト メタデータを均等に分散します。このため、サイトに異なるサイズのストレージ ノードが含まれている場合、サイトの最小のノードによってサイトのメタデータ容量が決まります。

次の例を考えてみましょう。

* 異なるサイズの 3 つのストレージ ノードを含む単一サイト グリッドがあります。
* *メタデータ予約領域*の設定は 4 TB です。
* ストレージ ノードには、実際に予約されているメタデータ領域と許可されているメタデータ領域について次の値が設定されます。
+
[cols="1a,1a,1a,1a"]
|===
| ストレージ ノード | ボリュームのサイズ 0 | 実際に予約されているメタデータ領域 | 許可されたメタデータスペース 


 a| 
SN1
 a| 
2.2 TB
 a| 
2.2 TB
 a| 
1.32 TB



 a| 
SN2
 a| 
5 TB
 a| 
4 TB
 a| 
1.98 TB



 a| 
SN3
 a| 
6 TB
 a| 
4 TB
 a| 
1.98 TB

|===


オブジェクト メタデータはサイト内のストレージ ノード全体に均等に分散されるため、この例では各ノードが保持できるメタデータは 1.32 TB のみです。  SN2 および SN3 に許可されている追加のメタデータ領域 0.66 TB は使用できません。

image::../media/metadata_space_three_storage_nodes.png[メタデータスペース 3つのストレージノード]

同様に、 StorageGRID は各サイトでStorageGRIDシステムのすべてのオブジェクト メタデータを維持するため、 StorageGRIDシステムの全体的なメタデータ容量は、最小のサイトのオブジェクト メタデータ容量によって決まります。

また、オブジェクトのメタデータ容量によって最大オブジェクト数が制御されるため、1 つのノードのメタデータ容量が不足すると、グリッドは事実上いっぱいになります。

.関連情報
* 各ストレージノードのオブジェクトメタデータ容量を監視する方法については、link:../monitor/index.html["StorageGRIDの監視"] 。
* システムのオブジェクトメタデータ容量を増やすには、link:../expand/index.html["グリッドを展開する"]新しいストレージノードを追加します。

