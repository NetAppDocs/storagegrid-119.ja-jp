---
permalink: maintain/restoring-volume.html 
sidebar: sidebar 
keywords: storagegrid, restore, volume 
summary: グリッド マネージャを使用して、障害が発生したストレージ ボリュームまたはストレージ ノードのオブジェクト データを復元できます。  Grid Manager を使用して、進行中の復元プロセスを監視したり、復元履歴を表示したりすることもできます。 
---
= グリッド マネージャーを使用してオブジェクト データを復元する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
グリッド マネージャを使用して、障害が発生したストレージ ボリュームまたはストレージ ノードのオブジェクト データを復元できます。  Grid Manager を使用して、進行中の復元プロセスを監視したり、復元履歴を表示したりすることもできます。

.開始する前に
* 障害が発生したボリュームをフォーマットするには、次のいずれかの手順を完了しました。
+
** link:../maintain/remounting-and-reformatting-appliance-storage-volumes.html["アプライアンスのストレージボリュームを再マウントして再フォーマットする（手動の手順）"]
** link:../maintain/remounting-and-reformatting-storage-volumes-manual-steps.html["ストレージボリュームの再マウントと再フォーマット（手動手順）"]


* オブジェクトを復元するストレージノードの接続状態が「*接続済み*」であることを確認しました。image:../media/icon_alert_green_checkmark.png["アイコンアラート緑のチェックマーク"]グリッド マネージャーの *ノード* > *概要* タブで。
* 以下のことを確認しました:
+
** ストレージ ノードを追加するためのグリッド拡張は実行されていません。
** ストレージ ノードの廃止が進行中ではないか、失敗しました。
** 障害が発生したストレージ ボリュームの回復は処理されていません。
** 障害が発生したシステム ドライブを持つストレージ ノードのリカバリは実行されていません。
** EC 再バランスジョブは処理されていません。
** アプライアンス ノードのクローン作成は実行されていません。




.タスク概要
ドライブを交換し、ボリュームをフォーマットする手動手順を実行すると、Grid Manager は *MAINTENANCE* > *ボリュームの復元* > *復元するノード* タブに復元の候補としてボリュームを表示します。

可能な場合は、グリッド マネージャーのボリューム復元ページを使用してオブジェクト データを復元します。どちらかを選択できます<<enable-auto-restore-mode,自動復元モードを有効にする>>ボリュームの復元準備が完了したらボリュームの復元を自動的に開始するか、<<manually-restore,ボリュームの復元を手動で実行する>> 。次のガイドラインに従ってください。

* ボリュームが *MAINTENANCE* > *ボリュームの復元* > *復元するノード* にリストされている場合は、以下の手順に従ってオブジェクト データを復元します。次の場合、ボリュームがリストされます。
+
** ノード内の一部のストレージボリュームに障害が発生しました
** ノード内のすべてのストレージボリュームに障害が発生し、同じ数以上のボリュームに置き換えられています


+
グリッドマネージャのボリューム復元ページでは、<<view-restoration-progress,ボリュームの復元プロセスを監視する>>そして<<view-restoration-history,復元履歴を表示>>。

* ボリュームがグリッドマネージャに復元候補としてリストされていない場合は、 `repair-data`オブジェクトデータを復元するスクリプト:
+
** link:restoring-object-data-to-storage-volume.html["オブジェクト データをストレージ ボリュームに復元しています (システム ドライブ障害)"]
** link:restoring-object-data-to-storage-volume-where-system-drive-is-intact.html["システムドライブがそのままのストレージボリュームにオブジェクトデータを復元する"]
** link:restoring-object-data-to-storage-volume-for-appliance.html["アプライアンスのストレージボリュームにオブジェクトデータを復元する"]
+

NOTE: repair-data スクリプトは非推奨であり、将来のリリースで削除される予定です。



+
回復したストレージノードに含まれるボリューム数が、交換するノードより少ない場合は、 `repair-data`スクリプト。



次の 2 種類のオブジェクト データを復元できます。

* グリッドの ILM ルールがオブジェクトのコピーを使用できるように構成されていることを前提として、複製されたデータ オブジェクトは他の場所から復元されます。
+
** ILM ルールが複製されたコピーを 1 つだけ保存するように設定されていて、そのコピーが障害が発生したストレージ ボリューム上に存在していた場合、オブジェクトを回復することはできません。
** オブジェクトの唯一のコピーが Cloud Storage Pool 内にある場合、 StorageGRID はオブジェクト データを復元するために Cloud Storage Pool エンドポイントに複数のリクエストを発行する必要があります。


* 消失符号化 (EC) データ オブジェクトは、保存されたフラグメントを再構成することによって復元されます。破損または失われたフラグメントは、残りのデータとパリティ フラグメントから消去コーディング アルゴリズムによって再作成されます。
+
一部のストレージ ノードがオフラインの場合でも、消去コード化されたデータの修復を開始できます。ただし、すべての消去コード化されたデータが確認できない場合は、修復を完了できません。すべてのノードが利用可能になると修復が完了します。




NOTE: ボリュームの復元は、オブジェクトのコピーが保存されているリソースの可用性に依存します。ボリュームの復元の進行は非線形であり、完了するまでに数日または数週間かかる場合があります。



== [[enable-auto-restore-mode]]自動復元モードを有効にする

自動復元モードを有効にすると、ボリュームの復元の準備ができたときにボリュームの復元が自動的に開始されます。

.手順
. Grid Manager で、*メンテナンス* > *ボリュームの復元* に移動します。
. *復元するノード*タブを選択し、*自動復元モード*のトグルを有効な位置にスライドします。
. 確認ダイアログボックスが表示されたら、詳細を確認します。
+
[NOTE]
====
** どのノードでもボリューム復元ジョブを手動で開始することはできません。
** ボリュームの復元は、他のメンテナンス手順が進行中でない場合にのみ自動的に開始されます。
** 進捗状況監視ページからジョブのステータスを監視できます。
** StorageGRID は、開始に失敗したボリュームの復元を自動的に再試行します。


====
. 自動復元モードを有効にした結果を理解したら、確認ダイアログボックスで「はい」を選択します。
+
自動復元モードはいつでも無効にすることができます。





== [[manually-restore]]障害が発生したボリュームまたはノードを手動で復元します

障害が発生したボリュームまたはノードを復元するには、次の手順に従います。

.手順
. Grid Manager で、*メンテナンス* > *ボリュームの復元* に移動します。
. *復元するノード*タブを選択し、*自動復元モード*のトグルを無効の位置にスライドします。
+
タブ上の数字は、復元が必要なボリュームを持つノードの数を示します。

. 各ノードを展開すると、復元が必要なボリュームとそのステータスが表示されます。
. 各ボリュームの復元を妨げる問題を修正します。ボリューム ステータスとして「*手動手順を待機中*」と表示される場合、それを選択すると問題が示されます。
. すべてのボリュームが復元準備完了ステータスを示している、復元するノードを選択します。
+
一度に復元できるのは 1 つのノードのボリュームのみです。

+
ノード内の各ボリュームは、復元の準備ができていることを示す必要があります。

. *復元の開始*を選択します。
. 表示される警告に対処するか、[とにかく開始] を選択して警告を無視し、復元を開始します。


復元が開始されると、ノードは *復元するノード* タブから *復元の進行状況* タブに移動されます。

ボリュームの復元を開始できない場合、ノードは「復元するノード」タブに戻ります。



== [[view-restoration-progress]]復元の進行状況を表示

*復元の進行状況*タブには、ボリューム復元プロセスのステータスと、復元中のノードのボリュームに関する情報が表示されます。

すべてのボリューム内の複製および消失訂正符号化オブジェクトのデータ修復率は、進行中のすべての修復を要約した平均であり、これには、 `repair-data`スクリプト。これらのボリューム内の、損傷がなく修復を必要としないオブジェクトの割合も示されます。


NOTE: 複製されたデータの復元は、複製されたコピーが保存されているリソースの可用性に依存します。複製されたデータの復元の進行は非線形であり、完了するまでに数日または数週間かかる場合があります。

復元ジョブ セクションには、グリッド マネージャーから開始されたボリュームの復元に関する情報が表示されます。

* 復元ジョブ セクションの見出しの数字は、復元中または復元キューに入っているボリュームの数を示します。
* 表には、復元中のノード内の各ボリュームとその進行状況に関する情報が表示されます。
+
** 各ノードの進行状況には、各ジョブのパーセンテージが表示されます。
** 詳細列を展開すると、復元の開始時刻とジョブ ID が表示されます。


* ボリュームの復元に失敗した場合:
+
** ステータス列には `failed (attempting retry)`自動的に再試行されます。
** 複数の復元ジョブが失敗した場合、最新のジョブが最初に自動的に再試行されます。
** 再試行が失敗し続ける場合、*EC 修復失敗* アラートがトリガーされます。問題を解決するには、アラートの手順に従ってください。






== [[view-restoration-history]]復元履歴を表示

*復元履歴*タブには、正常に完了したすべてのボリュームの復元に関する情報が表示されます。


NOTE: サイズは複製されたオブジェクトには適用されず、消失訂正符号化 (EC) データ オブジェクトを含む復元に対してのみ表示されます。
