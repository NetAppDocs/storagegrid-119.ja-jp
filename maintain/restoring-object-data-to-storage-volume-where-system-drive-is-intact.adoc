---
permalink: maintain/restoring-object-data-to-storage-volume-where-system-drive-is-intact.html 
sidebar: sidebar 
keywords: restore replicated data, restore erasure-coded data, recover storage node, recover storage volume 
summary: システム ドライブが完全な状態にあるストレージ ノード上のストレージ ボリュームを回復した後、ストレージ ボリュームの障害時に失われた複製または消去コード化されたオブジェクト データを復元できます。 
---
= システムドライブがそのままのストレージボリュームにオブジェクトデータを復元する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
システム ドライブが完全な状態にあるストレージ ノード上のストレージ ボリュームを回復した後、ストレージ ボリュームの障害時に失われた複製または消去コード化されたオブジェクト データを復元できます。



== どのような手順を使用すればよいですか?

可能な場合は、グリッド マネージャーの *ボリューム復元* ページを使用してオブジェクト データを復元します。

* ボリュームが*メンテナンス* > *ボリュームの復元* > *復元するノード*にリストされている場合は、link:../maintain/restoring-volume.html["グリッド マネージャーのボリューム復元ページ"] 。
* *メンテナンス* > *ボリュームの復元* > *復元するノード*にボリュームが表示されない場合は、以下の手順に従ってください。 `repair-data`オブジェクト データを復元するスクリプト。
+
回復したストレージノードに含まれるボリューム数が、交換するノードより少ない場合は、 `repair-data`スクリプト。




NOTE: repair-data スクリプトは非推奨であり、将来のリリースで削除される予定です。可能な場合は、link:../maintain/restoring-volume.html["グリッドマネージャでのボリューム復元手順"] 。



== 使用 `repair-data`オブジェクトデータを復元するスクリプト

.開始する前に
* 回復したストレージノードの接続状態が「接続済み」であることを確認しましたimage:../media/icon_alert_green_checkmark.png["アイコンアラート緑のチェックマーク"]グリッド マネージャーの *ノード* > *概要* タブで。


.タスク概要
グリッドの ILM ルールがオブジェクトのコピーを使用できるように構成されていると仮定すると、オブジェクト データは他のストレージ ノードまたはクラウド ストレージ プールから復元できます。

次の点に注意してください。

* ILM ルールが複製されたコピーを 1 つだけ保存するように設定されていて、そのコピーが障害が発生したストレージ ボリューム上に存在していた場合、オブジェクトを回復することはできません。
* オブジェクトの唯一のコピーが Cloud Storage Pool 内にある場合、 StorageGRID はオブジェクト データを復元するために Cloud Storage Pool エンドポイントに複数のリクエストを発行する必要があります。この手順を実行する前に、テクニカル サポートに問い合わせて、回復の所要時間と関連コストの見積もりを依頼してください。




== について `repair-data`スクリプト

オブジェクトデータを復元するには、 `repair-data`スクリプト。このスクリプトは、オブジェクト データの復元プロセスを開始し、ILM スキャンと連携して ILM ルールが満たされていることを確認します。

以下の*複製データ*または*消失訂正符号化（EC）データ*を選択して、 `repair-data`複製されたデータを復元するのか、消失訂正符号化されたデータを復元するのかに応じて、スクリプトを選択します。両方の種類のデータを復元する必要がある場合は、両方のコマンド セットを実行する必要があります。


NOTE: 詳細については、 `repair-data`スクリプトを入力 `repair-data --help`プライマリ管理ノードのコマンド ラインから。


NOTE: repair-data スクリプトは非推奨であり、将来のリリースで削除される予定です。可能な場合は、link:../maintain/restoring-volume.html["グリッドマネージャでのボリューム復元手順"] 。

[role="tabbed-block"]
====
.複製されたデータ
--
複製されたデータを復元するには、ノード全体を修復する必要があるか、ノード上の特定のボリュームのみを修復する必要があるかに応じて、次の 2 つのコマンドを使用できます。

`repair-data start-replicated-node-repair`

`repair-data start-replicated-volume-repair`

次のコマンドを使用して、複製されたデータの修復を追跡できます。

`repair-data show-replicated-repair-status`

--
.消失訂正符号化（EC）データ
--
ノード全体を修復する必要があるか、ノード上の特定のボリュームのみを修復する必要があるかに応じて、消去コード化されたデータを復元するための 2 つのコマンドが使用できます。

`repair-data start-ec-node-repair`

`repair-data start-ec-volume-repair`

次のコマンドを使用して、消去コード化されたデータの修復を追跡できます。

`repair-data show-ec-repair-status`


NOTE: 一部のストレージ ノードがオフラインの場合でも、消去コード化されたデータの修復を開始できます。ただし、すべての消去コード化されたデータを把握できない場合は、修復を完了できません。すべてのノードが利用可能になると修復が完了します。


NOTE: EC 修復ジョブでは、一時的に大量のストレージが予約されます。ストレージアラートがトリガーされる可能性がありますが、修復が完了すると解決されます。予約に十分なストレージがない場合、EC 修復ジョブは失敗します。  EC 修復ジョブが完了すると、ジョブが失敗したか成功したかに関係なく、ストレージ予約が解放されます。

--
====


== ストレージノードのホスト名を見つける

. プライマリ管理ノードにログインします。
+
.. 次のコマンドを入力します。 `ssh admin@_primary_Admin_Node_IP_`
.. 記載されているパスワードを入力してください `Passwords.txt`ファイル。
.. ルートに切り替えるには、次のコマンドを入力します。 `su -`
.. 記載されているパスワードを入力してください `Passwords.txt`ファイル。
+
ルートとしてログインすると、プロンプトは `$`に `#`。



. 使用 `/etc/hosts`ファイルを使用して、復元されたストレージ ボリュームのストレージ ノードのホスト名を見つけます。グリッド内のすべてのノードのリストを表示するには、次のように入力します。 `cat /etc/hosts` 。




== すべてのボリュームに障害が発生した場合にデータを修復する

すべてのストレージ ボリュームに障害が発生した場合は、ノード全体を修復します。複製データ、消失訂正符号化 (EC) データ、またはその両方のいずれを使用するかに応じて、*複製データ*、*消失訂正符号化 (EC) データ*、またはその両方の手順に従います。

一部のボリュームのみが故障している場合は、<<一部のボリュームのみが故障した場合にデータを修復する>> 。


NOTE: 走れない `repair-data`複数のノードに対して同時に操作を実行します。複数のノードを回復するには、テクニカル サポートにお問い合わせください。

[role="tabbed-block"]
====
.複製されたデータ
--
グリッドに複製データが含まれている場合は、 `repair-data start-replicated-node-repair`コマンドを `--nodes`オプション、ここで `--nodes`ストレージノード全体を修復するためのホスト名 (システム名) です。

このコマンドは、SG-DC-SN3 という名前のストレージ ノード上の複製されたデータを修復します。

`repair-data start-replicated-node-repair --nodes SG-DC-SN3`


NOTE: オブジェクト データが復元されるときに、 StorageGRIDシステムが複製されたオブジェクト データを見つけられない場合は、*オブジェクト損失* アラートがトリガーされます。システム全体のストレージ ノードでアラートがトリガーされる可能性があります。損失の原因と回復が可能かどうかを判断する必要があります。見るlink:../troubleshoot/investigating-lost-objects.html["紛失物の調査"] 。

--
.消失訂正符号化（EC）データ
--
グリッドに消失訂正符号化データが含まれている場合は、 `repair-data start-ec-node-repair`コマンドを `--nodes`オプション、ここで `--nodes`ストレージノード全体を修復するためのホスト名 (システム名) です。

このコマンドは、SG-DC-SN3 という名前のストレージ ノード上の消去コード化されたデータを修復します。

`repair-data start-ec-node-repair --nodes SG-DC-SN3`

この操作は一意の `repair ID`これを識別する `repair_data`手術。これを使う `repair ID`進捗状況と結果を追跡する `repair_data`手術。回復プロセスが完了しても、その他のフィードバックは返されません。

一部のストレージ ノードがオフラインの場合でも、消去コード化されたデータの修復を開始できます。すべてのノードが利用可能になると修復が完了します。

--
====


== 一部のボリュームのみが故障した場合にデータを修復する

一部のボリュームのみに障害が発生した場合は、影響を受けるボリュームを修復します。複製データ、消失訂正符号化 (EC) データ、またはその両方のいずれを使用するかに応じて、*複製データ*、*消失訂正符号化 (EC) データ*、またはその両方の手順に従います。

すべてのボリュームが失敗した場合は、<<すべてのボリュームに障害が発生した場合にデータを修復する>> 。

ボリューム ID を 16 進数で入力します。例えば、 `0000`最初の巻であり、 `000F`第16巻です。  1 つのボリューム、ボリュームの範囲、または連続していない複数のボリュームを指定できます。

すべてのボリュームは同じストレージ ノード上にある必要があります。複数のストレージ ノードのボリュームを復元する必要がある場合は、テクニカル サポートにお問い合わせください。

[role="tabbed-block"]
====
.複製されたデータ
--
グリッドに複製されたデータが含まれている場合は、 `start-replicated-volume-repair`コマンドを `--nodes`ノードを識別するオプション（ `--nodes`ノードのホスト名です。次に、 `--volumes`または `--volume-range`オプションは次の例のように使用できます。

*単一ボリューム*: このコマンドは複製されたデータをボリュームに復元します `0002`SG-DC-SN3 というストレージノード上:

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0002`

*ボリュームの範囲*: このコマンドは、範囲内のすべてのボリュームに複製されたデータを復元します。 `0003`に `0009`SG-DC-SN3 というストレージノード上:

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volume-range 0003,0009`

*複数のボリュームが連続していない*: このコマンドは、複製されたデータをボリュームに復元します `0001`、 `0005` 、 そして `0008`SG-DC-SN3 というストレージノード上:

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0001,0005,0008`


NOTE: オブジェクト データが復元されるときに、 StorageGRIDシステムが複製されたオブジェクト データを見つけられない場合は、*オブジェクト損失* アラートがトリガーされます。システム全体のストレージ ノードでアラートがトリガーされる可能性があります。アラートの説明と推奨されるアクションに注意してください。損失の原因を特定し、回復が可能かどうかを確認します。

--
.消失訂正符号化（EC）データ
--
グリッドに消失訂正符号化データが含まれている場合は、 `start-ec-volume-repair`コマンドを `--nodes`ノードを識別するオプション（ `--nodes`ノードのホスト名です。次に、 `--volumes`または `--volume-range`オプションは次の例のように使用できます。

*単一ボリューム*: このコマンドは、消去符号化されたデータをボリュームに復元します `0007`SG-DC-SN3 というストレージノード上:

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 0007`

*ボリュームの範囲*: このコマンドは、範囲内のすべてのボリュームに消去符号化データを復元します。 `0004`に `0006`SG-DC-SN3 というストレージノード上:

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volume-range 0004,0006`

*複数のボリュームが連続していない*: このコマンドは、消去符号化されたデータをボリュームに復元します `000A`、 `000C` 、 そして `000E`SG-DC-SN3 というストレージノード上:

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 000A,000C,000E`

その `repair-data`操作は一意の値を返す `repair ID`これを識別する `repair_data`手術。これを使う `repair ID`進捗状況と結果を追跡する `repair_data`手術。回復プロセスが完了しても、その他のフィードバックは返されません。


NOTE: 一部のストレージ ノードがオフラインの場合でも、消去コード化されたデータの修復を開始できます。すべてのノードが利用可能になると修復が完了します。

--
====


== モニターの修理

*複製されたデータ*、*消失訂正符号化 (EC) データ*、またはその両方を使用するかどうかに基づいて、修復ジョブのステータスを監視します。

進行中のボリューム復元ジョブのステータスを監視したり、完了した復元ジョブの履歴を表示したりすることもできます。link:../maintain/restoring-volume.html["Grid Manager"] 。

[role="tabbed-block"]
====
.複製されたデータ
--
* 複製された修復の推定完了率を取得するには、 `show-replicated-repair-status` repair-data コマンドのオプション。
+
`repair-data show-replicated-repair-status`

* 修復が完了したかどうかを確認するには:
+
.. *NODES* > *_修復中のストレージノード_* > *ILM* を選択します。
.. 評価セクションの属性を確認します。修復が完了すると、「待機中 - すべて」属性にオブジェクトが 0 個と表示されます。


* 修復をより詳細に監視するには:
+
.. *サポート* > *ツール* > *グリッド トポロジ* を選択します。
.. *_grid_* > *_修復中のストレージノード_* > *LDR* > *データ ストア* を選択します。
.. 次の属性の組み合わせを使用して、複製された修復が完了しているかどうかを可能な限り判断します。
+

NOTE: Cassandra に不整合が存在する可能性があり、失敗した修復は追跡されません。

+
*** *修復試行 (XRPA)*: この属性を使用して、複製された修復の進行状況を追跡します。この属性は、ストレージ ノードが高リスクのオブジェクトの修復を試みるたびに増加します。この属性が現在のスキャン期間（*スキャン期間 - 推定*属性によって指定）よりも長い期間増加しない場合は、ILM スキャンでどのノードにも修復が必要な高リスク オブジェクトが見つからなかったことを意味します。
+

NOTE: 高リスクオブジェクトとは、完全に失われる危険性があるオブジェクトです。これには、ILM 構成を満たさないオブジェクトは含まれません。

*** *スキャン期間 - 推定 (XSCM)*: この属性を使用して、以前に取り込まれたオブジェクトにポリシーの変更がいつ適用されるかを推定します。 *修復試行* 属性が現在のスキャン期間よりも長い期間増加しない場合は、複製された修復が行われた可能性があります。スキャン期間は変更される可能性があることに注意してください。 *スキャン期間 - 推定 (XSCM)* 属性はグリッド全体に適用され、すべてのノード スキャン期間の最大値になります。グリッドの *スキャン期間 - 推定* 属性履歴を照会して、適切な時間枠を決定できます。






--
.消失訂正符号化（EC）データ
--
消去コード化されたデータの修復を監視し、失敗した可能性のある要求を再試行するには:

. 消失訂正符号化データの修復ステータスを確認します。
+
** 現在のジョブの完了までの推定時間と完了率を表示するには、[サポート] > [ツール] > [メトリック] を選択します。次に、Grafana セクションで *EC 概要* を選択します。*グリッド EC ジョブの完了推定時間*ダッシュボードと*グリッド EC ジョブの完了率*ダッシュボードを確認します。
** このコマンドを使用して、特定の `repair-data`手術：
+
`repair-data show-ec-repair-status --repair-id repair ID`

** すべての修復を一覧表示するには、次のコマンドを使用します。
+
`repair-data show-ec-repair-status`

+
出力には以下の情報が含まれます。 `repair ID` 、過去および現在実行中のすべての修復。



. 出力に修復操作が失敗したことが示されている場合は、 `--repair-id`修復を再試行するオプション。
+
このコマンドは、修復 ID 6949309319275667690 を使用して、失敗したノードの修復を再試行します。

+
`repair-data start-ec-node-repair --repair-id 6949309319275667690`

+
このコマンドは、修復 ID 6949309319275667690 を使用して、失敗したボリューム修復を再試行します。

+
`repair-data start-ec-volume-repair --repair-id 6949309319275667690`



--
====