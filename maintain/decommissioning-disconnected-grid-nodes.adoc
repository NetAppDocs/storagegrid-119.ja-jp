---
permalink: maintain/decommissioning-disconnected-grid-nodes.html 
sidebar: sidebar 
keywords: storagegrid, disconnected nodes, decommission node 
summary: 現在グリッドに接続されていないノード（ヘルスが不明または管理上ダウンしているノード）を廃止する必要がある場合があります。 
---
= 切断されたグリッドノードの廃止
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
現在グリッドに接続されていないノード (ヘルスが不明または管理上ダウンしているノード) を廃止する必要がある場合があります。

.開始する前に
* 廃止に関する考慮事項を理解しているlink:considerations-for-decommissioning-admin-or-gateway-nodes.html["管理ノードとゲートウェイノード"]廃止措置に関する検討link:considerations-for-decommissioning-storage-nodes.html["ストレージ ノード"]。
* 前提条件となるアイテムをすべて取得しました。
* アクティブなデータ修復ジョブがないことを確認しました。見るlink:checking-data-repair-jobs.html["データ修復ジョブを確認する"] 。
* グリッド内のどこでもストレージ ノードのリカバリが進行中ではないことを確認しました。そうである場合は、リカバリの一環として実行される Cassandra の再構築が完了するまで待つ必要があります。その後、廃止手続きに進むことができます。
* ノード廃止手順が一時停止されていない限り、ノード廃止手順の実行中は他のメンテナンス手順が実行されないことを確認しました。
* 切断されたノードまたは廃止するノードの *廃止可能* 列に緑色のチェックマークが表示されます。
* プロビジョニング パスフレーズを持っています。


.タスク概要
切断されたノードは、青い不明アイコンで識別できます。image:../media/icon_alarm_blue_unknown.png["アイコン不明"]または灰色の管理ダウンアイコンimage:../media/icon_alarm_gray_administratively_down.png["アイコンが管理上ダウンしている"]*健康*列に表示されます。

切断されたノードを廃止する前に、次の点に注意してください。

* この手順は主に、切断された単一のノードを削除することを目的としています。グリッドに切断されたノードが複数含まれている場合、ソフトウェアではそれらをすべて同時に廃止する必要があり、予期しない結果が生じる可能性が高くなります。
+

CAUTION: 一度に複数の切断されたストレージ ノードを廃止すると、データが失われる可能性があります。見るlink:considerations-for-decommissioning-storage-nodes.html#considerations-disconnected-storage-nodes["切断されたストレージノードに関する考慮事項"] 。

+

CAUTION: ソフトウェア ベースのメタデータのみのノードを含むグリッド内のストレージ ノードを廃止する場合は注意してください。オブジェクトとメタデータの両方を保存するように構成されたすべてのノードを廃止すると、オブジェクトを保存する機能がグリッドから削除されます。見るlink:../primer/what-storage-node-is.html#types-of-storage-nodes["ストレージノードの種類"]メタデータのみのストレージ ノードの詳細については、こちらをご覧ください。

* 切断されたノードを削除できない場合 (たとえば、ADC クォーラムに必要なストレージ ノードなど)、他の切断されたノードを削除することはできません。


.手順
. アーカイブ ノード (切断されている必要があります) を廃止する場合を除き、切断されたグリッド ノードをオンラインに戻すか、回復するようにしてください。
+
見るlink:warnings-and-considerations-for-grid-node-recovery.html["グリッドノードの回復手順"]手順についてはこちらをご覧ください。

. 切断されたグリッド ノードを回復できず、切断されたままそのノードを廃止する場合は、そのノードのチェック ボックスをオンにします。
+

NOTE: グリッドに切断されたノードが複数含まれている場合、ソフトウェアではそれらをすべて同時に廃止する必要があり、予期しない結果が生じる可能性が高くなります。

+

CAUTION: 一度に複数の切断されたグリッド ノードを廃止することを選択する場合、特に複数の切断されたストレージ ノードを選択する場合には注意してください。復旧できない切断されたストレージ ノードが複数ある場合は、テクニカル サポートに連絡して最善の対処方法を確認してください。

. プロビジョニング パスフレーズを入力します。
+
*廃止の開始*ボタンが有効になります。

. *廃止の開始*をクリックします。
+
切断されたノードを選択したため、そのノードにオブジェクトのコピーが 1 つしか存在しない場合はオブジェクト データが失われることを示す警告が表示されます。

. ノードのリストを確認し、「*OK*」をクリックします。
+
廃止手順が開始され、各ノードの進行状況が表示されます。手順中に、グリッド構成の変更を含む新しいリカバリ パッケージが生成されます。

. 新しいリカバリ パッケージが利用可能になったらすぐに、リンクをクリックするか、[メンテナンス] > [システム] > [リカバリ パッケージ] を選択して、リカバリ パッケージ ページにアクセスします。次に、 `.zip`ファイル。
+
説明書をご覧くださいlink:downloading-recovery-package.html["リカバリパッケージのダウンロード"]。

+

NOTE: 廃止手順中に問題が発生した場合にグリッドを回復できるように、できるだけ早くリカバリ パッケージをダウンロードしてください。

+

CAUTION: リカバリ パッケージ ファイルには、 StorageGRIDシステムからデータを取得するために使用できる暗号化キーとパスワードが含まれているため、セキュリティ保護する必要があります。

. 選択したすべてのノードが正常に廃止されたことを確認するために、「廃止」ページを定期的に監視します。
+
ストレージ ノードの廃止には数日または数週間かかる場合があります。すべてのタスクが完了すると、ノード選択リストが成功メッセージとともに再表示されます。切断されたストレージ ノードを廃止した場合、修復ジョブが開始されたことを示す情報メッセージが表示されます。

. 廃止手順の一環としてノードが自動的にシャットダウンされたら、廃止されたノードに関連付けられている残りの仮想マシンやその他のリソースを削除します。
+

CAUTION: ノードが自動的にシャットダウンするまで、この手順を実行しないでください。

. ストレージ ノードを廃止する場合は、廃止プロセス中に自動的に開始される *複製データ* および *消去コード化 (EC) データ* 修復ジョブのステータスを監視します。


[role="tabbed-block"]
====
.複製されたデータ
--
* 複製された修復の推定完了率を取得するには、 `show-replicated-repair-status` repair-data コマンドのオプション。
+
`repair-data show-replicated-repair-status`

* 修復が完了したかどうかを確認するには:
+
.. *NODES* > *_修復中のストレージノード_* > *ILM* を選択します。
.. 評価セクションの属性を確認します。修復が完了すると、「待機中 - すべて」属性にオブジェクトが 0 個と表示されます。


* 修復をより詳細に監視するには:
+
.. *サポート* > *ツール* > *グリッド トポロジ* を選択します。
.. *_grid_* > *_修復中のストレージノード_* > *LDR* > *データ ストア* を選択します。
.. 次の属性の組み合わせを使用して、複製された修復が完了しているかどうかを可能な限り判断します。
+

NOTE: Cassandra に不整合が存在する可能性があり、失敗した修復は追跡されません。

+
*** *修復試行 (XRPA)*: この属性を使用して、複製された修復の進行状況を追跡します。この属性は、ストレージ ノードが高リスクのオブジェクトの修復を試みるたびに増加します。この属性が現在のスキャン期間（*スキャン期間 - 推定*属性によって指定）よりも長い期間増加しない場合は、ILM スキャンでどのノードにも修復が必要な高リスク オブジェクトが見つからなかったことを意味します。
+

NOTE: 高リスクオブジェクトとは、完全に失われる危険性があるオブジェクトです。これには、ILM 構成を満たさないオブジェクトは含まれません。

*** *スキャン期間 - 推定 (XSCM)*: この属性を使用して、以前に取り込まれたオブジェクトにポリシーの変更がいつ適用されるかを推定します。 *修復試行* 属性が現在のスキャン期間よりも長い期間増加しない場合は、複製された修復が行われた可能性があります。スキャン期間は変更される可能性があることに注意してください。 *スキャン期間 - 推定 (XSCM)* 属性はグリッド全体に適用され、すべてのノード スキャン期間の最大値になります。グリッドの *スキャン期間 - 推定* 属性履歴を照会して、適切な時間枠を決定できます。






--
.消失訂正符号化（EC）データ
--
消去コード化されたデータの修復を監視し、失敗した可能性のある要求を再試行するには:

. 消失訂正符号化データの修復ステータスを確認します。
+
** 現在のジョブの完了までの推定時間と完了率を表示するには、[サポート] > [ツール] > [メトリック] を選択します。次に、Grafana セクションで *EC 概要* を選択します。*グリッド EC ジョブの完了推定時間*ダッシュボードと*グリッド EC ジョブの完了率*ダッシュボードを確認します。
** このコマンドを使用して、特定の `repair-data`手術：
+
`repair-data show-ec-repair-status --repair-id repair ID`

** すべての修復を一覧表示するには、次のコマンドを使用します。
+
`repair-data show-ec-repair-status`

+
出力には以下の情報が含まれます。 `repair ID` 、過去および現在実行中のすべての修復。



. 出力に修復操作が失敗したことが示されている場合は、 `--repair-id`修復を再試行するオプション。
+
このコマンドは、修復 ID 6949309319275667690 を使用して、失敗したノードの修復を再試行します。

+
`repair-data start-ec-node-repair --repair-id 6949309319275667690`

+
このコマンドは、修復 ID 6949309319275667690 を使用して、失敗したボリューム修復を再試行します。

+
`repair-data start-ec-volume-repair --repair-id 6949309319275667690`



--
====
.終了後の操作
切断されたノードが廃止され、すべてのデータ修復ジョブが完了したら、必要に応じて接続されているグリッド ノードを廃止できます。

廃止手順を完了したら、次の手順を実行します。

* 廃止されたグリッド ノードのドライブが完全に消去されていることを確認します。市販のデータ消去ツールまたはサービスを使用して、ドライブからデータを永久的かつ安全に削除します。
* アプライアンス ノードを廃止し、アプライアンス上のデータがノード暗号化を使用して保護されていた場合は、 StorageGRIDアプライアンス インストーラを使用してキー管理サーバーの構成をクリアします (KMS のクリア)。アプライアンスを別のグリッドに追加する場合は、KMS 構成をクリアする必要があります。手順については、 https://docs.netapp.com/us-en/storagegrid-appliances/commonhardware/monitoring-node-encryption-in-maintenance-mode.html["メンテナンスモードでノードの暗号化を監視する"^] 。

