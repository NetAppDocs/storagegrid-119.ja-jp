---
permalink: maintain/considerations-for-removing-site.html 
sidebar: sidebar 
keywords: how to remove site 
summary: サイト廃止手順を使用してサイトを削除する前に、考慮事項を確認する必要があります。 
---
= サイトの削除に関する考慮事項
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
サイト廃止手順を使用してサイトを削除する前に、考慮事項を確認する必要があります。



== サイトを廃止すると何が起こるか

サイトを廃止すると、 StorageGRID はサイト上のすべてのノードとサイト自体をStorageGRIDシステムから永久に削除します。

サイトの廃止手順が完了すると、次のようになります。

* StorageGRIDを使用してサイトまたはサイト内のノードを表示したりアクセスしたりすることはできなくなります。
* サイトを参照していたストレージ プールや消去コーディング プロファイルは使用できなくなります。  StorageGRIDがサイトを廃止すると、これらのストレージ プールが自動的に削除され、これらの消去コーディング プロファイルが非アクティブ化されます。




== 接続サイトと切断サイトの廃止手順の違い

サイトの廃止手順を使用すると、すべてのノードがStorageGRIDに接続されているサイトを削除したり (接続サイトの廃止と呼ばれます)、すべてのノードがStorageGRIDから切断されているサイトを削除したり (切断サイトの廃止と呼ばれます) できます。始める前に、これらの手順の違いを理解しておく必要があります。


NOTE: サイト内に接続済みの（image:../media/icon_alert_green_checkmark.png["アイコンアラート緑のチェックマーク"] ）と切断されたノード（image:../media/icon_alarm_gray_administratively_down.png["アイコンアラームグレー管理上ダウン"]またはimage:../media/icon_alarm_blue_unknown.png["アイコン アラーム 青 不明"]) の場合、すべてのオフライン ノードをオンラインに戻す必要があります。

* 接続されたサイトの廃止により、運用サイトをStorageGRIDシステムから削除できます。たとえば、接続されたサイトの廃止を実行して、機能しているが不要になったサイトを削除できます。
* StorageGRID は接続されたサイトを削除すると、ILM を使用してそのサイトのオブジェクト データを管理します。接続されたサイトの廃止を開始する前に、すべての ILM ルールからサイトを削除し、新しい ILM ポリシーをアクティブ化する必要があります。オブジェクト データを移行する ILM プロセスとサイトを削除する内部プロセスは同時に実行できますが、実際の廃止手順を開始する前に ILM 手順を完了させることがベスト プラクティスです。
* 切断されたサイトの廃止により、障害が発生したサイトをStorageGRIDシステムから削除できます。たとえば、切断されたサイトの廃止を実行して、火災や洪水によって破壊されたサイトを削除することができます。
+
StorageGRID は切断されたサイトを削除すると、すべてのノードが回復不能であると見なし、データの保存を試みません。ただし、切断されたサイトの廃止を開始する前に、すべての ILM ルールからサイトを削除し、新しい ILM ポリシーをアクティブ化する必要があります。

+

CAUTION: 切断されたサイトの廃止手順を実行する前に、 NetAppアカウント担当者に連絡する必要があります。 NetApp は、サイトの廃止ウィザードのすべての手順を有効にする前に、お客様の要件を確認します。サイトを回復したり、サイトからオブジェクト データを回復したりできる可能性があると思われる場合は、切断されたサイトの廃止を試みないでください。





== 接続されたサイトまたは切断されたサイトを削除するための一般的な要件

接続済みまたは切断されたサイトを削除する前に、次の要件を認識しておく必要があります。

* プライマリ管理ノードを含むサイトを廃止することはできません。
* いずれかのノードに高可用性 (HA) グループに属するインターフェースがある場合は、サイトを廃止することはできません。  HA グループを編集してノードのインターフェースを削除するか、HA グループ全体を削除する必要があります。
* 接続されている（image:../media/icon_alert_green_checkmark.png["アイコンアラート緑のチェックマーク"] ）および切断（image:../media/icon_alarm_blue_unknown.png["アイコン アラーム 青 不明"]またはimage:../media/icon_alarm_gray_administratively_down.png["アイコンアラームグレー管理上ダウン"]) ノード。
* 他のサイトのいずれかのノードが切断されている場合、サイトを廃止することはできません（image:../media/icon_alarm_blue_unknown.png["アイコン アラーム 青 不明"]またはimage:../media/icon_alarm_gray_administratively_down.png["アイコンアラームグレー管理上ダウン"]）。
* ec-node-repair 操作が進行中の場合は、サイトの廃止手順を開始できません。見るlink:checking-data-repair-jobs.html["データ修復ジョブを確認する"]消失訂正符号化データの修復を追跡します。
* サイトの廃止手順の実行中:
+
** 廃止されるサイトを参照する ILM ルールを作成することはできません。また、サイトを参照する既存の ILM ルールを編集することもできません。
** 拡張やアップグレードなどのその他のメンテナンス手順を実行することはできません。
+

NOTE: 接続されたサイトの廃止中に別のメンテナンス手順を実行する必要がある場合は、link:pausing-and-resuming-decommission-process-for-storage-nodes.html["ストレージノードの削除中は手順を一時停止します"] 。  *一時停止* ボタンは、ILM 評価または消去コード化されたデータの廃止段階に達したときにのみ有効になります。ただし、ILM 評価 (データ移行) はバックグラウンドで引き続き実行されます。  2 回目のメンテナンス手順が完了したら、廃止を再開できます。

** サイトの廃止手順を開始した後にノードを回復する必要がある場合は、サポートに連絡する必要があります。


* 一度に複数のサイトを廃止することはできません。
* サイトに 1 つ以上の管理ノードが含まれており、 StorageGRIDシステムに対してシングル サインオン (SSO) が有効になっている場合は、Active Directory フェデレーション サービス (AD FS) からサイトのすべての証明書利用者信頼を削除する必要があります。




== 情報ライフサイクル管理（ILM）の要件

サイトの削除の一環として、ILM 構成を更新する必要があります。サイトの廃止ウィザードでは、次の事項を確実に実行するためのいくつかの前提条件手順を案内します。

* このサイトは、どの ILM ポリシーでも参照されません。そうである場合は、ポリシーを編集するか、新しい ILM ルールを使用してポリシーを作成してアクティブ化する必要があります。
* どのポリシーでも使用されていない場合でも、ILM ルールはサイトを参照しません。サイトを参照するすべてのルールを削除または編集する必要があります。


StorageGRIDがサイトを廃止すると、サイトを参照する未使用の消去コーディング プロファイルが自動的に非アクティブ化され、サイトを参照する未使用のストレージ プールが自動的に削除されます。  「すべてのストレージ ノード」ストレージ プールが存在する場合 (StorageGRID 11.6 以前)、このプールはすべてのサイトを使用するため削除されます。


CAUTION: サイトを削除する前に、新しい ILM ルールを作成し、新しい ILM ポリシーをアクティブ化する必要がある場合があります。これらの手順では、ILM の仕組みを十分に理解していること、ストレージ プール、消去コーディング プロファイル、ILM ルールの作成、ILM ポリシーのシミュレーションとアクティブ化に精通していることを前提としています。見るlink:../ilm/index.html["ILMでオブジェクトを管理する"] 。



== 接続されたサイトのオブジェクトデータに関する考慮事項

接続されたサイトの廃止を実行する場合は、新しい ILM ルールと新しい ILM ポリシーを作成するときに、サイトの既存のオブジェクト データをどのように処理するかを決定する必要があります。次のいずれかまたは両方を行うことができます。

* 選択したサイトからグリッド内の 1 つ以上の他のサイトにオブジェクト データを移動します。
+
*データ移動の例*: サニーベールに新しいサイトを追加したため、ローリーのサイトを廃止するとします。この例では、すべてのオブジェクト データを古いサイトから新しいサイトに移動します。 ILM ルールと ILM ポリシーを更新する前に、両方のサイトの容量を確認する必要があります。サニーベール サイトに、ローリー サイトからのオブジェクト データを収容するのに十分な容量があること、また将来の成長に備えて十分な容量がサニーベールに残っていることを確認する必要があります。

+

NOTE: 十分な容量を確保するには、link:../expand/index.html["グリッドを展開する"]この手順を実行する前に、既存のサイトにストレージ ボリュームまたはストレージ ノードを追加するか、新しいサイトを追加してください。

* 選択したサイトからオブジェクトのコピーを削除します。
+
*データ削除の例*: 現在、3 つのコピーの ILM ルールを使用して、3 つのサイト間でオブジェクト データを複製しているとします。サイトを廃止する前に、同等の 2 コピーの ILM ルールを作成して、2 つのサイトにのみデータを保存できます。 2 コピー ルールを使用する新しい ILM ポリシーをアクティブ化すると、 StorageGRID は、3 番目のサイトからコピーを削除します。これは、それらのコピーが ILM 要件を満たさなくなったためです。ただし、オブジェクト データは引き続き保護され、残りの 2 つのサイトの容量は同じままになります。

+

CAUTION: サイトの削除に対応するために、単一コピーの ILM ルールを作成しないでください。任意の期間に複製されたコピーを 1 つだけ作成する ILM ルールでは、データが永久に失われるリスクがあります。オブジェクトの複製されたコピーが 1 つしか存在しない場合、ストレージ ノードに障害が発生したり重大なエラーが発生すると、そのオブジェクトは失われます。また、アップグレードなどのメンテナンス手順中は、オブジェクトへのアクセス権が一時的に失われます。





== 接続サイトの廃止に関する追加要件

StorageGRID が接続されたサイトを削除する前に、次の点を確認する必要があります。

* StorageGRIDシステム内のすべてのノードの接続状態は*接続済み*である必要があります（image:../media/icon_alert_green_checkmark.png["アイコンアラート緑のチェックマーク"] ); ただし、ノードにはアクティブなアラートが存在する場合があります。
+

NOTE: 1 つ以上のノードが切断されている場合は、サイトの廃止ウィザードの手順 1 ～ 4 を完了できます。ただし、すべてのノードが接続されていない限り、廃止プロセスを開始するウィザードのステップ 5 を完了することはできません。

* 削除する予定のサイトに、負荷分散に使用されるゲートウェイノードまたは管理ノードが含まれている場合は、link:../expand/index.html["グリッドを展開する"]別のサイトに同等の新しいノードを追加します。サイトの廃止手順を開始する前に、クライアントが交換ノードに接続できることを確認してください。
* 削除する予定のサイトに、高可用性 (HA) グループ内のゲートウェイ ノードまたは管理ノードが含まれている場合は、サイトの廃止ウィザードの手順 1 ～ 4 を完了できます。ただし、これらのノードをすべての HA グループから削除するまで、廃止プロセスを開始するウィザードの手順 5 を完了することはできません。既存のクライアントがサイトのノードを含む HA グループに接続する場合は、サイトが削除された後もStorageGRIDに引き続き接続できることを確認する必要があります。
* 削除する予定のサイトでクライアントがストレージ ノードに直接接続している場合は、サイトの廃止手順を開始する前に、クライアントが他のサイトのストレージ ノードに接続できることを確認する必要があります。
* アクティブな ILM ポリシーの変更によって移動されるオブジェクト データを収容するために、残りのサイトに十分なスペースを用意する必要があります。場合によっては、link:../expand/index.html["グリッドを展開する"]接続されたサイトの廃止を完了する前に、ストレージ ノード、ストレージ ボリューム、または新しいサイトを追加する必要があります。
* 廃止手順が完了するまで十分な時間を確保する必要があります。  StorageGRID ILM プロセスでは、サイトを廃止する前にサイトからオブジェクト データを移動または削除するのに数日、数週間、または数か月かかる場合があります。
+

NOTE: サイトからオブジェクト データを移動または削除するには、サイトのデータ量、システムの負荷、ネットワークの遅延、必要な ILM 変更の性質に応じて、数日、数週間、または数か月かかる場合があります。

* 可能な限り、サイトの廃止ウィザードの手順 1 ～ 4 をできるだけ早く完了する必要があります。実際の廃止手順を開始する前に、サイトからデータを移動できるようにすると (ウィザードの手順 5 で [廃止の開始] を選択)、廃止手順はより迅速に完了し、中断やパフォーマンスへの影響も少なくなります。




== 切断されたサイトの廃止に関する追加要件

StorageGRIDが切断されたサイトを削除する前に、次の点を確認する必要があります。

* NetAppアカウント担当者に問い合わせました。  NetApp は、サイトの廃止ウィザードのすべての手順を有効にする前に、お客様の要件を確認します。
+

CAUTION: サイトを回復したり、サイトからオブジェクト データを回復したりできる可能性があると思われる場合は、切断されたサイトの廃止を試みないでください。見るlink:how-site-recovery-is-performed-by-technical-support.html["テクニカルサポートがサイトを復旧する方法"] 。

* サイトのすべてのノードの接続状態は次のいずれかである必要があります。
+
** *未知* （image:../media/icon_alarm_blue_unknown.png["アイコン アラーム 青 不明"] ): 不明な理由により、ノードが切断されたか、ノード上のサービスが予期せず停止しました。たとえば、ノード上のサービスが停止したり、停電や予期しない停止のためにノードのネットワーク接続が失われたりする可能性があります。
** *管理上ダウン*（image:../media/icon_alarm_gray_administratively_down.png["アイコンアラームグレー管理上ダウン"] ): 予期された理由により、ノードはグリッドに接続されていません。たとえば、ノードまたはノード上のサービスが正常にシャットダウンされました。


* 他のすべてのサイトのすべてのノードの接続状態は*接続済み*である必要があります（image:../media/icon_alert_green_checkmark.png["アイコンアラート緑のチェックマーク"] ); ただし、これらの他のノードにはアクティブなアラートが存在する可能性があります。
* サイトに保存されていたオブジェクト データをStorageGRIDを使用して表示したり取得したりすることができなくなることを理解しておく必要があります。  StorageGRID がこの手順を実行する場合、切断されたサイトのデータは保存されません。
+

NOTE: ILM ルールとポリシーが単一サイトの損失から保護するように設計されている場合、オブジェクトのコピーは残りのサイトに残ります。

* サイトにオブジェクトの唯一のコピーが含まれている場合、オブジェクトは失われ、取得できないことを理解する必要があります。




== サイトを削除する際の一貫性に関する考慮事項

S3 バケットの一貫性により、オブジェクトの取り込みが成功したことをクライアントに通知する前に、 StorageGRID がオブジェクトのメタデータをすべてのノードとサイトに完全に複製するかどうかが決まります。一貫性は、オブジェクトの可用性と、異なるストレージ ノードおよびサイト間でのオブジェクトの一貫性との間のバランスを提供します。

StorageGRIDがサイトを削除する場合、削除するサイトにデータが書き込まれないようにする必要があります。その結果、各バケットまたはコンテナの一貫性が一時的に上書きされます。サイトの廃止プロセスを開始すると、 StorageGRID は強力なサイト整合性を一時的に使用して、削除されるサイトにオブジェクト メタデータが書き込まれるのを防ぎます。

この一時的なオーバーライドの結果として、残りのサイトで複数のノードが使用できなくなった場合、サイトの廃止中に発生するクライアントの書き込み、更新、および削除操作が失敗する可能性があることに注意してください。
