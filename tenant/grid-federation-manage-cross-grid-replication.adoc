---
permalink: tenant/grid-federation-manage-cross-grid-replication.html 
sidebar: sidebar 
keywords: grid federation, cross-grid replication, use grid federation connection, replicate client delete markers, s3 bucket 
summary: テナント アカウントの作成時に「グリッド フェデレーション接続の使用」権限が割り当てられている場合は、クロス グリッド レプリケーションを使用して、テナント ソース グリッドのバケットとテナント デスティネーション グリッドのバケット間でオブジェクトを自動的にレプリケートできます。グリッド間のレプリケーションは、一方向または双方向で発生する可能性があります。 
---
= クロスグリッドレプリケーションを管理する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
テナント アカウントの作成時に *グリッド フェデレーション接続の使用* 権限が割り当てられている場合は、クロス グリッド レプリケーションを使用して、テナントのソース グリッド上のバケットとテナントの宛先グリッド上のバケット間でオブジェクトを自動的に複製できます。グリッド間のレプリケーションは、一方向または双方向で発生する可能性があります。



== クロスグリッドレプリケーションのワークフロー

ワークフロー図は、2 つのグリッド上のバケット間のグリッド間レプリケーションを構成するために実行する手順をまとめたものです。これらの手順については以下で詳しく説明します。

image::../media/grid-federation-cgr-workflow.png[クロスグリッドレプリケーションワークフロー]



== クロスグリッドレプリケーションを構成する

クロスグリッドレプリケーションを使用する前に、各グリッドの対応するテナント アカウントにサインインし、同一のバケットを作成する必要があります。次に、いずれかまたは両方のバケットでクロスグリッド レプリケーションを有効にできます。

.開始する前に
* クロスグリッド レプリケーションの要件を確認しました。見るlink:../admin/grid-federation-what-is-cross-grid-replication.html["クロスグリッドレプリケーションとは"] 。
* 使用していますlink:../admin/web-browser-requirements.html["サポートされているウェブブラウザ"]。
* テナント アカウントには *グリッド フェデレーション接続を使用する* 権限があり、両方のグリッドに同一のテナント アカウントが存在します。見るlink:../admin/grid-federation-manage-tenants.html["グリッドフェデレーション接続に許可されたテナントを管理する"] 。
* サインインするテナントユーザーは両方のグリッドに既に存在し、link:tenant-management-permissions.html["ルートアクセス権限"] 。
* テナントの宛先グリッドにローカル ユーザーとしてサインインする場合、テナント アカウントのルート ユーザーがそのグリッド上のユーザー アカウントのパスワードを設定しています。




=== 同一のバケットを2つ作成する

最初のステップとして、各グリッドの対応するテナント アカウントにサインインし、同一のバケットを作成します。

.手順
. グリッド フェデレーション接続のいずれかのグリッドから開始して、新しいバケットを作成します。
+
.. 両方のグリッドに存在するテナント ユーザーの資格情報を使用して、テナント アカウントにSign in。
+

NOTE: ローカル ユーザーとしてテナントの宛先グリッドにサインインできない場合は、テナント アカウントのルート ユーザーがユーザー アカウントのパスワードを設定していることを確認します。

.. 指示に従ってlink:creating-s3-bucket.html["S3バケットを作成する"]。
.. *オブジェクト設定の管理*タブで、*オブジェクトのバージョン管理を有効にする*を選択します。
.. StorageGRIDシステムで S3 オブジェクト ロックが有効になっている場合は、バケットで S3 オブジェクト ロックを有効にしないでください。
.. *バケットを作成*を選択します。
.. *完了*を選択します。


. これらの手順を繰り返して、グリッド フェデレーション接続内の他のグリッド上の同じテナント アカウントに対して同一のバケットを作成します。
+

TIP: 必要に応じて、各バケットは異なるリージョンを使用できます。





=== クロスグリッドレプリケーションを有効にする

いずれかのバケットにオブジェクトを追加する前に、これらの手順を実行する必要があります。

.手順
. 複製したいオブジェクトがあるグリッドから開始し、link:../admin/grid-federation-what-is-cross-grid-replication.html["一方向のクロスグリッドレプリケーション"] :
+
.. バケットのテナント アカウントにSign in。
.. ダッシュボードから*バケットの表示*を選択するか、*ストレージ (S3)* > *バケット*を選択します。
.. バケットの詳細ページにアクセスするには、テーブルからバケット名を選択します。
.. *クロスグリッドレプリケーション*タブを選択します。
.. *有効*を選択し、要件のリストを確認します。
.. すべての要件が満たされている場合は、使用するグリッド フェデレーション接続を選択します。
.. オプションで、*削除マーカーを複製する* の設定を変更して、S3 クライアントがバージョン ID を含まないソース グリッドへの削除リクエストを発行した場合に、宛先グリッドで何が起こるかを決定します。
+
*** *はい* (デフォルト): 削除マーカーがソース バケットに追加され、宛先バケットに複製されます。
*** *いいえ*: 削除マーカーはソースバケットに追加されますが、宛先バケットには複製されません。
+
image::../media/grid-federation-cross-grid-replication-client-deletes.png[両方のグリッドで複製クライアントの削除を示す画像]

+

NOTE: 削除リクエストにバージョン ID が含まれている場合、そのオブジェクト バージョンはソース バケットから完全に削除されます。StorageGRID はバージョン ID を含む削除要求を複製しないため、同じオブジェクト バージョンが宛先から削除されません。

+
見るlink:../admin/grid-federation-what-is-cross-grid-replication.html["クロスグリッドレプリケーションとは"]詳細については。



.. 必要に応じて、*クロスグリッド レプリケーション* 監査カテゴリの設定を変更して、監査メッセージの量を管理します。
+
*** *エラー* (デフォルト): 監査出力には、失敗したクロスグリッド レプリケーション要求のみが含まれます。
*** *通常*: すべてのクロスグリッド レプリケーション要求が含まれるため、監査出力の量が大幅に増加します。


.. 選択内容を確認します。両方のバケットが空でない限り、これらの設定を変更することはできません。
.. *有効化してテスト*を選択します。
+
しばらくすると、成功メッセージが表示されます。このバケットに追加されたオブジェクトは、他のグリッドに自動的に複製されるようになります。*クロスグリッド レプリケーション* は、バケットの詳細ページで有効な機能として表示されます。



. オプションとして、他のグリッドの対応するバケットに移動し、link:../admin/grid-federation-what-is-cross-grid-replication.html["双方向のグリッド間レプリケーションを有効にする"] 。




== グリッド間のレプリケーションをテストする

バケットに対してクロスグリッド レプリケーションが有効になっている場合は、接続とクロスグリッド レプリケーションが正しく機能していること、およびソース バケットと宛先バケットがすべての要件を満たしていること (たとえば、バージョン管理がまだ有効になっていること) を確認する必要がある場合があります。

.開始する前に
* 使用していますlink:../admin/web-browser-requirements.html["サポートされているウェブブラウザ"]。
* あなたは、link:tenant-management-permissions.html["ルートアクセス権限"] 。


.手順
. バケットのテナント アカウントにSign in。
. ダッシュボードから*バケットの表示*を選択するか、*ストレージ (S3)* > *バケット*を選択します。
. バケットの詳細ページにアクセスするには、テーブルからバケット名を選択します。
. *クロスグリッドレプリケーション*タブを選択します。
. *テスト接続*を選択します。
+
接続が正常な場合は、成功バナーが表示されます。それ以外の場合はエラー メッセージが表示され、グリッド管理者はそのメッセージを使用して問題を解決できます。詳細については、 link:../admin/grid-federation-troubleshoot.html["グリッドフェデレーションエラーのトラブルシューティング"] 。

. クロスグリッド レプリケーションが双方向で実行されるように構成されている場合は、他のグリッドの対応するバケットに移動し、[テスト接続] を選択して、クロスグリッド レプリケーションが反対方向で動作していることを確認します。




== クロスグリッドレプリケーションを無効にする

オブジェクトを他のグリッドにコピーする必要がなくなった場合は、グリッド間のレプリケーションを完全に停止できます。

クロスグリッド レプリケーションを無効にする前に、次の点に注意してください。

* グリッド間のレプリケーションを無効にしても、グリッド間ですでにコピーされているオブジェクトは削除されません。例えば、 `my-bucket`グリッド1にコピーされた `my-bucket`グリッド 2 のバケットのクロスグリッド レプリケーションを無効にしても、そのバケットのクロスグリッド レプリケーションは削除されません。これらのオブジェクトを削除する場合は、手動で削除する必要があります。
* 各バケットに対してクロスグリッド レプリケーションが有効になっている場合 (つまり、双方向でレプリケーションが行われる場合)、いずれかまたは両方のバケットに対してクロスグリッド レプリケーションを無効にすることができます。たとえば、オブジェクトの複製を無効にしたい場合、 `my-bucket`グリッド1から `my-bucket`グリッド2では、 `my-bucket`グリッド2から `my-bucket`グリッド1上。
* グリッド フェデレーション接続を使用するためのテナントの権限を削除する前に、クロス グリッド レプリケーションを無効にする必要があります。見るlink:../admin/grid-federation-manage-tenants.html["許可されたテナントを管理する"] 。
* オブジェクトを含むバケットのクロスグリッド レプリケーションを無効にすると、ソース バケットと宛先バケットの両方からすべてのオブジェクトを削除しない限り、クロスグリッド レプリケーションを再度有効にすることはできません。
+

CAUTION: 両方のバケットが空でない限り、レプリケーションを再度有効にすることはできません。



.開始する前に
* 使用していますlink:../admin/web-browser-requirements.html["サポートされているウェブブラウザ"]。
* あなたは、link:tenant-management-permissions.html["ルートアクセス権限"] 。


.手順
. 複製する必要がなくなったオブジェクトを含むグリッドから開始して、バケットのグリッド間レプリケーションを停止します。
+
.. バケットのテナント アカウントにSign in。
.. ダッシュボードから*バケットの表示*を選択するか、*ストレージ (S3)* > *バケット*を選択します。
.. バケットの詳細ページにアクセスするには、テーブルからバケット名を選択します。
.. *クロスグリッドレプリケーション*タブを選択します。
.. *レプリケーションを無効にする*を選択します。
.. このバケットのクロスグリッド レプリケーションを無効にする場合は、テキスト ボックスに「*はい*」と入力し、「*無効*」を選択します。
+
しばらくすると、成功メッセージが表示されます。このバケットに追加された新しいオブジェクトは、他のグリッドに自動的に複製できなくなります。  *クロスグリッド レプリケーション* は、バケット ページで有効な機能として表示されなくなりました。



. クロスグリッド レプリケーションが双方向で実行されるように構成されている場合は、他のグリッド上の対応するバケットに移動し、反対方向のクロスグリッド レプリケーションを停止します。

