---
permalink: ubuntu/node-container-migration-requirements.html 
sidebar: sidebar 
keywords: node container migration requirements 
summary: ノード移行機能を使用すると、ノードをあるホストから別のホストに手動で移動できます。通常、両方のホストは同じ物理データセンター内にあります。 
---
= ノードコンテナの移行要件
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ノード移行機能を使用すると、ノードをあるホストから別のホストに手動で移動できます。通常、両方のホストは同じ物理データセンター内にあります。

ノードの移行により、グリッド操作を中断することなく物理ホストのメンテナンスを実行できます。物理ホストをオフラインにする前に、すべてのStorageGRIDノードを 1 つずつ別のホストに移動します。ノードの移行には各ノードの短いダウンタイムのみが必要であり、グリッド サービスの操作や可用性には影響しません。

StorageGRIDノード移行機能を使用する場合は、展開が追加の要件を満たしている必要があります。

* 単一の物理データセンター内のホスト間で一貫したネットワーク インターフェース名
* 単一の物理データセンター内のすべてのホストからアクセスできる、 StorageGRIDメタデータおよびオブジェクト リポジトリ ボリュームの共有ストレージ。たとえば、 NetApp E シリーズ ストレージ アレイを使用できます。


仮想ホストを使用しており、基盤となるハイパーバイザー層が VM の移行をサポートしている場合は、 StorageGRIDのノード移行機能の代わりにこの機能を使用することをお勧めします。この場合、これらの追加要件は無視できます。

移行またはハイパーバイザーのメンテナンスを実行する前に、ノードを正常にシャットダウンします。説明書をご覧くださいlink:../maintain/shutting-down-grid-node.html["グリッドノードのシャットダウン"]。



== VMware ライブマイグレーションはサポートされていません

VMware VM 上でベアメタル インストールを実行すると、OpenStack Live Migration および VMware live vMotion によって仮想マシンのクロック時間がジャンプし、どのタイプのグリッド ノードでもサポートされません。まれではありますが、クロック時刻が正しくないと、データが失われたり、構成が更新されたりする可能性があります。

コールド移行がサポートされています。コールド移行では、ホスト間で移行する前にStorageGRIDノードをシャットダウンします。説明書をご覧くださいlink:../maintain/shutting-down-grid-node.html["グリッドノードのシャットダウン"]。



== 一貫したネットワークインターフェース名

ノードをあるホストから別のホストに移動するには、 StorageGRIDホスト サービスが、ノードの現在の場所にある外部ネットワーク接続が新しい場所で複製できることをある程度確信している必要があります。この信頼性は、ホスト内で一貫したネットワーク インターフェイス名を使用することで得られます。

たとえば、Host1 上で実行されているStorageGRID NodeA が次のインターフェース マッピングで設定されているとします。

image::../media/eth0_bond.gif[この図には説明が付随しています。]

矢印の左側は、 StorageGRIDコンテナ内から見た従来のインターフェース (それぞれ、グリッド、管理、クライアント ネットワーク インターフェース) に対応します。矢印の右側は、これらのネットワークを提供する実際のホスト インターフェイスに対応しており、同じ物理インターフェイス ボンドに従属する 3 つの VLAN インターフェイスです。

ここで、NodeA を Host2 に移行するとします。  Host2 にも bond0.1001、bond0.1002、bond0.1003 という名前のインターフェースがある場合、システムは、同様の名前のインターフェースが Host2 でも Host1 と同じ接続性を提供するものと想定して、移動を許可します。  Host2 に同じ名前のインターフェースがない場合、移動は許可されません。

複数のホスト間で一貫したネットワークインターフェース命名を実現する方法は多数あります。link:configuring-host-network.html["ホストネットワークを構成する"]いくつかの例を示します。



== 共有ストレージ

高速でオーバーヘッドの少ないノード移行を実現するために、 StorageGRIDノード移行機能ではノード データを物理的に移動しません。代わりに、ノードの移行は、次のようにエクスポート操作とインポート操作のペアとして実行されます。

.手順
. 「ノード エクスポート」操作中に、HostA で実行されているノード コンテナーから少量の永続状態データが抽出され、そのノードのシステム データ ボリュームにキャッシュされます。次に、HostA 上のノード コンテナーのインスタンスが解除されます。
. 「ノードのインポート」操作中に、HostA で有効だったものと同じネットワーク インターフェイスとブロック ストレージ マッピングを使用する HostB 上のノード コンテナーがインスタンス化されます。次に、キャッシュされた永続状態データが新しいインスタンスに挿入されます。


この動作モードでは、移行が許可され、機能するためには、ノードのすべてのシステム データとオブジェクト ストレージ ボリュームが HostA と HostB の両方からアクセスできる必要があります。さらに、HostA と HostB 上の同じ LUN を参照することが保証される名前を使用して、ノードにマッピングされている必要があります。

次の例は、DMマルチパスがホスト上で使用されており、エイリアスフィールドが使用されているStorageGRIDストレージノードのブロックデバイスマッピングの1つのソリューションを示しています。 `/etc/multipath.conf`すべてのホストで使用できる一貫性のあるわかりやすいブロックデバイス名を提供します。

image::../media/block_device_mapping_rhel.gif[この図には説明が付随しています。]
