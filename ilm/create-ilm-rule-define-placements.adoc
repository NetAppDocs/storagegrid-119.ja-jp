---
permalink: ilm/create-ilm-rule-define-placements.html 
sidebar: sidebar 
keywords: ilm rule step 2, define placements 
summary: 'ILM ルールの作成ウィザードの配置の定義手順では、オブジェクトを保存する期間、コピーの種類 (複製または消去コード化)、保存場所、およびコピーの数を決定する配置手順を定義できます。' 
---
= ステップ2/3: 配置を定義する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ILM ルールの作成ウィザードの *配置の定義* ステップでは、オブジェクトの保存期間、コピーの種類 (複製または消去コード化)、保存場所、およびコピーの数を決定する配置手順を定義できます。


NOTE: 表示されているスクリーンショットは例です。結果はStorageGRID のバージョンによって異なる場合があります。

.タスク概要
ILM ルールには、1 つ以上の配置指示を含めることができます。各配置指示は単一の期間に適用されます。複数の命令を使用する場合、期間は連続している必要があり、少なくとも 1 つの命令は 0 日目から開始する必要があります。指示は永久に継続することも、オブジェクトのコピーが不要になるまで継続することもできます。

異なる種類のコピーを作成したり、その期間中に異なる場所を使用したりする場合は、各配置指示に複数の行を含めることができます。

この例では、ILM ルールによって、最初の 1 年間、複製されたコピーがサイト 1 に 1 つ、複製されたコピーがサイト 2 に 1 つ保存されます。  1 年後、2+1 の消去コード化されたコピーが作成され、1 つのサイトにのみ保存されます。

image::../media/ilm_create_ilm_rule_wizard_2.png[ILMルール作成ウィザードステップ2]

.手順
. *参照時間*では、配置指示の開始時間を計算するときに使用する時間の種類を選択します。
+
[cols="1a,2a"]
|===
| オプション | 説明 


 a| 
取り込み時間
 a| 
オブジェクトが取り込まれた時刻。



 a| 
最終アクセス時間
 a| 
オブジェクトが最後に取得（読み取りまたは表示）された時刻。

このオプションを使用するには、S3 バケットの最終アクセス時刻の更新を有効にする必要があります。。 link:using-last-access-time-in-ilm-rules.html["ILMルールで最終アクセス時刻を使用する"] 。



 a| 
ユーザー定義の作成時間
 a| 
ユーザー定義のメタデータで指定された時間。



 a| 
非現在の時刻
 a| 
「このルールを古いオブジェクトバージョンにのみ適用しますか（バージョン管理が有効になっているS3バケット内）」という質問に対して*はい*を選択した場合、「非現在時刻」が自動的に選択されます。link:create-ilm-rule-enter-details.html["ILMルールの作成ウィザードのステップ1"] 。

|===
+
_準拠_ルールを作成する場合は、*取り込み時間*を選択する必要があります。。 link:managing-objects-with-s3-object-lock.html["S3 オブジェクトロックでオブジェクトを管理する"] 。

. *期間と配置*セクションで、最初の期間の開始時刻と期間を入力します。
+
たとえば、最初の 1 年間にオブジェクトを保存する場所を指定することができます (_0 日目から 365 日間保存_)。少なくとも 1 つの命令は 0 日目から開始する必要があります。

. 複製コピーを作成する場合:
+
.. *オブジェクトの保存方法*ドロップダウンリストから、*複製*を選択します。
.. 作成するコピーの数を選択します。
+
コピー数を 1 に変更すると警告が表示されます。任意の期間に複製されたコピーを 1 つだけ作成する ILM ルールでは、データが永久に失われるリスクがあります。。 link:why-you-should-not-use-single-copy-replication.html["シングルコピーレプリケーションを使用しない理由"] 。

+
リスクを回避するには、次の 1 つ以上の手順を実行します。

+
*** 期間内のコピー数を増やします。
*** 他のストレージ プールまたはクラウド ストレージ プールにコピーを追加します。
*** *複製*の代わりに*消去コーディング*を選択します。
+
このルールによってすでにすべての期間に複数のコピーが作成されている場合は、この警告を無視しても問題ありません。



.. *コピー先* フィールドで、追加するストレージ プールを選択します。
+
*ストレージ プールを 1 つだけ指定する場合*、 StorageGRID は特定のストレージ ノード上にオブジェクトの複製されたコピーを 1 つだけ保存できることに注意してください。グリッドに 3 つのストレージ ノードが含まれており、コピー数として 4 を選択した場合、ストレージ ノードごとに 1 つのコピー、つまり 3 つのコピーのみが作成されます。

+
*ILM 配置不可能* アラートは、ILM ルールを完全に適用できなかったことを示すためにトリガーされます。

+
*複数のストレージ プールを指定する場合*、次のルールに注意してください。

+
*** コピーの数はストレージ プールの数より大きくすることはできません。
*** コピーの数がストレージ プールの数と等しい場合、オブジェクトのコピーが 1 つずつ各ストレージ プールに保存されます。
*** コピー数がストレージ プールの数より少ない場合、1 つのコピーが取り込みサイトに保存され、システムは残りのコピーを分散してプール間のディスク使用量のバランスを保ちながら、どのサイトにもオブジェクトのコピーが複数保存されないようにします。
*** ストレージ プールが重複している場合 (同じストレージ ノードが含まれている場合)、オブジェクトのすべてのコピーが 1 つのサイトのみに保存される可能性があります。このため、All Storage Nodes ストレージ プール (StorageGRID 11.6 以前) と別のストレージ プールを指定しないでください。




. 消去コード化されたコピーを作成する場合:
+
.. *オブジェクトの保存方法*ドロップダウンリストから、*消失訂正符号*を選択します。
+

NOTE: 消失訂正符号化は、1 MB を超えるオブジェクトに最適です。非常に小さな消去符号化フラグメントを管理するオーバーヘッドを回避するために、200 KB 未満のオブジェクトには消去符号化を使用しないでください。

.. 200 KB を超える値のオブジェクト サイズ フィルターを追加しなかった場合は、[前へ] を選択して手順 1 に戻ります。次に、[*詳細フィルターの追加*] を選択し、[*オブジェクト サイズ*] フィルターを 200 KB を超える値に設定します。
.. 追加するストレージ プールと使用する消去コーディング スキームを選択します。
+
消去コード化されたコピーの保存場所には、消去コード化スキームの名前と、それに続くストレージ プールの名前が含まれます。

+
使用可能な消去コーディング スキームは、選択したストレージ プール内のストレージ ノードの数によって制限されます。あ `Recommended`バッジは、次のいずれかを提供するスキームの横に表示されます。link:../ilm/what-erasure-coding-schemes-are.html["最高の保護または最低のストレージオーバーヘッド"] 。



. オプション:
+
.. 別の場所に追加のコピーを作成するには、「*他のタイプまたは場所を追加*」を選択します。
.. 別の期間を追加するには、「*別の期間を追加*」を選択します。
+
[NOTE]
====
オブジェクトの削除は、次の設定に基づいて行われます。

*** 別の期間が「永久に」終了しない限り、オブジェクトは最終期間の終了時に自動的に削除されます。
*** に応じてlink:../ilm/example-8-priorities-for-s3-bucket-lifecycle-and-ilm-policy.html#example-of-bucket-lifecycle-taking-priority-over-ilm-policy["バケットとテナントの保持期間の設定"]ILM 保持期間が終了してもオブジェクトが削除されない可能性があります。


====


. オブジェクトをクラウド ストレージ プールに保存する場合:
+
.. *オブジェクトの保存方法*ドロップダウンリストで、*複製*を選択します。
.. *コピー先*フィールドを選択し、クラウド ストレージ プールを選択します。
+
クラウド ストレージ プールを使用する場合は、次のルールに留意してください。

+
*** 1 つの配置指示で複数のクラウド ストレージ プールを選択することはできません。同様に、同じ配置指示でクラウド ストレージ プールとストレージ プールを選択することはできません。
*** 特定のクラウド ストレージ プールには、オブジェクトのコピーを 1 つだけ保存できます。  *コピー数*を2以上に設定すると、エラーメッセージが表示されます。
*** 同時に複数のオブジェクト コピーをどのクラウド ストレージ プールにも保存することはできません。クラウド ストレージ プールを使用する複数の配置で日付が重複している場合、または同じ配置内の複数の行でクラウド ストレージ プールを使用している場合は、エラー メッセージが表示されます。
*** オブジェクトがStorageGRIDに複製または消去コード化されたコピーとして保存されるのと同時に、そのオブジェクトを Cloud Storage Pool に保存できます。ただし、期間の配置指示には複数の行を含めて、場所ごとにコピーの数と種類を指定する必要があります。




. 保持図で、配置の指示を確認します。
+
この例では、ILM ルールによって、最初の 1 年間、複製されたコピーがサイト 1 に 1 つ、複製されたコピーがサイト 2 に 1 つ保存されます。 1 年後からさらに 10 年間、6+3 の消去コード化されたコピーが 3 つのサイトに保存されます。合計 11 年が経過すると、オブジェクトはStorageGRIDから削除されます。

+
保持図のルール分析セクションには次のように記載されています。

+
** このルールの期間中、 StorageGRIDサイト損失保護が適用されます。
** このルールによって処理されたオブジェクトは、4015 日目以降に削除されます。
+
参照link:using-multiple-storage-pools-for-cross-site-replication.html["サイト損失保護を有効にします。"]

+
image::../media/ilm_rule_retention_diagram.png[ILMルール保持図]



. *続行*を選択します。link:create-ilm-rule-select-ingest-behavior.html["ステップ3（取り込み動作を選択）"]ILM ルールの作成ウィザードが表示されます。

