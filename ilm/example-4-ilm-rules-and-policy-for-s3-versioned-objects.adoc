---
permalink: ilm/example-4-ilm-rules-and-policy-for-s3-versioned-objects.html 
sidebar: sidebar 
keywords: object versions, example ILM rule, information lifecycle rule examples 
summary: バージョン管理が有効になっている S3 バケットがある場合は、非現在の時間を参照時間として使用するルールを ILM ポリシーに含めることで、非現在のオブジェクト バージョンを管理できます。 
---
= 例4: S3バージョン管理オブジェクトのILMルールとポリシー
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
バージョン管理が有効になっている S3 バケットがある場合は、参照時間として「非現在の時間」を使用するルールを ILM ポリシーに含めることで、非現在のオブジェクト バージョンを管理できます。


CAUTION: オブジェクトの保存期間を限定的に指定すると、その期間が経過するとオブジェクトは完全に削除されます。オブジェクトが保持される期間を必ず理解してください。

この例が示すように、非現在のオブジェクト バージョンに対して異なる配置手順を使用することで、バージョン管理されたオブジェクトが使用するストレージの量を制御できます。


CAUTION: 次の ILM ルールとポリシーは例にすぎません。 ILM ルールを構成する方法は多数あります。新しいポリシーを有効にする前に、ポリシーをシミュレートして、コンテンツの損失を防ぐためにポリシーが意図したとおりに機能することを確認します。


NOTE: オブジェクトの非現在のバージョンに対して ILM ポリシー シミュレーションを実行するには、オブジェクト バージョンの UUID または CBID を知っておく必要があります。  UUIDとCBIDを見つけるには、link:verifying-ilm-policy-with-object-metadata-lookup.html["オブジェクトメタデータ検索"]オブジェクトがまだ最新の状態である間。

.関連情報
link:how-objects-are-deleted.html["オブジェクトの削除方法"]



== 例4のILMルール1: 10年間コピーを3つ保存する

この例の ILM ルールでは、各オブジェクトのコピーを 3 つのサイトに 10 年間保存します。

このルールは、バージョン管理されているかどうかに関係なく、すべてのオブジェクトに適用されます。

[cols="1a,2a"]
|===
| ルールの定義 | 値の例 


 a| 
ストレージプール
 a| 
それぞれ異なるデータ センターで構成される、サイト 1、サイト 2、サイト 3 という名前の 3 つのストレージ プール。



 a| 
ルール名
 a| 
3部10年



 a| 
基準時間
 a| 
取り込み時間



 a| 
配置
 a| 
0 日目には、複製された 3 つのコピーを 10 年間 (3,652 日間) 保持します (1 つはサイト 1、1 つはサイト 2、1 つはサイト 3)。  10 年が経過したら、オブジェクトのすべてのコピーを削除します。

|===


== 例4のILMルール2: 非現行バージョンのコピーを2年間保存する

この例の ILM ルールは、S3 バージョン管理オブジェクトの非現在のバージョンの 2 つのコピーを 2 年間保存します。

ILM ルール 1 はオブジェクトのすべてのバージョンに適用されるため、現在のバージョン以外のバージョンを除外するための別のルールを作成する必要があります。

参照時間として「非現在時刻」を使用するルールを作成するには、ILM ルールの作成ウィザードのステップ 1 (詳細の入力) で、「このルールを古いオブジェクト バージョンにのみ適用しますか (バージョン管理が有効になっている S3 バケット内)?」という質問に対して *はい* を選択します。  *はい*を選択すると、参照時刻として_非現在の時刻_が自動的に選択され、別の参照時刻を選択することはできません。

image::../media/ilm-rule-apply-only-to-older-object-verions.png[ILM ルールを古いオブジェクト バージョンにのみ適用する (非現在時間)]

この例では、非現在のバージョンのコピーが 2 つだけ保存され、それらのコピーは 2 年間保存されます。

[cols="1a,2a"]
|===
| ルールの定義 | 値の例 


 a| 
ストレージ プール
 a| 
2 つのストレージ プール (それぞれ異なるデータ センター、サイト 1 とサイト 2)。



 a| 
ルール名
 a| 
非現行バージョン: 2部 2年間



 a| 
基準時間
 a| 
非現在の時刻

ILM ルールの作成ウィザードで、「このルールを古いオブジェクト バージョンにのみ適用しますか (バージョン管理が有効になっている S3 バケット内)?」という質問に対して *はい* を選択すると、自動的に選択されます。



 a| 
配置
 a| 
非現在の時間を基準とした 0 日目 (つまり、オブジェクト バージョンが非現在のバージョンになる日から開始) に、非現在のオブジェクト バージョンの複製された 2 つのコピーを 2 年間 (730 日間) 保持します (1 つはサイト 1、もう 1 つはサイト 2)。  2 年が経過したら、非最新バージョンを削除します。

|===


== ILM ポリシーの例 4: S3 バージョン管理オブジェクト

オブジェクトの古いバージョンを現在のバージョンとは異なる方法で管理する場合は、参照時間として「非現在の時間」を使用するルールが、現在のオブジェクト バージョンに適用されるルールの前に ILM ポリシーに表示されている必要があります。

S3 バージョン管理オブジェクトの ILM ポリシーには、次のような ILM ルールが含まれる場合があります。

* 各オブジェクトの古い (非最新) バージョンは、そのバージョンが非最新になった日から 2 年間保存します。
+

NOTE: 「非現在の時間」ルールは、現在のオブジェクト バージョンに適用されるルールの前にポリシー内に表示する必要があります。そうしないと、非現在のオブジェクト バージョンは、「非現在の時間」ルールに一致することはありません。

* 取り込み時に、複製されたコピーを 3 つ作成し、3 つのサイトのそれぞれに 1 つのコピーを保存します。現在のオブジェクト バージョンのコピーを 10 年間保存します。


サンプル ポリシーをシミュレートすると、テスト オブジェクトが次のように評価されることが予想されます。

* 現在のオブジェクト バージョン以外はすべて、最初のルールに一致します。非現在のオブジェクト バージョンが 2 年以上経過している場合、ILM によって完全に削除されます (非現在のバージョンのすべてのコピーがグリッドから削除されます)。
* 現在のオブジェクト バージョンは、2 番目のルールと一致します。現在のオブジェクト バージョンが 10 年間保存されると、ILM プロセスによってオブジェクトの現在のバージョンとして削除マーカーが追加され、以前のオブジェクト バージョンが「非最新」になります。次回の ILM 評価時に、この非最新バージョンが最初のルールと一致します。その結果、サイト 3 のコピーは削除され、サイト 1 とサイト 2 の 2 つのコピーはさらに 2 年間保存されます。

