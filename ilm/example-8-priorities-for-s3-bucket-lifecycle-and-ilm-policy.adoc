---
permalink: ilm/example-8-priorities-for-s3-bucket-lifecycle-and-ilm-policy.html 
sidebar: sidebar 
keywords: retention priority, example S3 bucket lifecycle, example ILM policy 
summary: ライフサイクル設定に応じて、オブジェクトは S3 バケットライフサイクルまたは ILM ポリシーの保持設定に従います。 
---
= 例8: S3バケットライフサイクルとILMポリシーの優先順位
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ライフサイクル設定に応じて、オブジェクトは S3 バケットライフサイクルまたは ILM ポリシーの保持設定に従います。



== ILM ポリシーよりも優先されるバケット ライフサイクルの例

ILM ポリシー::
+
--
* 非現在時刻参照に基づくルール: 0日目にX個のコピーを20日間保存する
* 取り込み時間参照に基づくルール（デフォルト）：0日目にX個のコピーを50日間保持する


--
バケットのライフサイクル:: `"Filter": {"Prefix": "docs/"}, "Expiration": {"Days": 100}, "NoncurrentVersionExpiration": {"NoncurrentDays": 5}`
結果::
+
--
* 「docs/text」という名前のオブジェクトが取り込まれます。これは、「docs/」プレフィックスのバケットライフサイクル フィルターと一致します。
+
** 100 日後に削除マーカーが作成され、「docs/text」は非最新になります。
** 取り込みから 5 日後、合計 105 日後に、「docs/text」は削除されます。
** 95 日後、つまり取り込みから合計 200 日と削除マーカーの作成から 100 日が経過すると、期限切れの削除マーカーは削除されます。


* 「video/movie」という名前のオブジェクトが取り込まれます。フィルターに一致しないため、ILM 保持ポリシーが使用されます。
+
** 50 日後に削除マーカーが作成され、「ビデオ/ムービー」は最新ではなくなります。
** 取り込みから20日、合計70日が経過すると、「ビデオ/ムービー」は削除されます。
** 30 日後、つまり取り込みから合計 100 日と削除マーカーの作成から 50 日が経過すると、期限切れの削除マーカーは削除されます。




--




== 暗黙的に永久に保持されるバケットライフサイクルの例

ILM ポリシー::
+
--
* 非現在時刻参照に基づくルール: 0日目にX個のコピーを20日間保存する
* 取り込み時間参照に基づくルール（デフォルト）：0日目にX個のコピーを50日間保持する


--
バケットのライフサイクル:: `"Filter": {"Prefix": "docs/"}, "Expiration": {"ExpiredObjectDeleteMarker": true}`
結果::
+
--
* 「docs/text」という名前のオブジェクトが取り込まれます。これは、「docs/」プレフィックスのバケットライフサイクル フィルターと一致します。
+
その `Expiration`このアクションは期限切れの削除マーカーにのみ適用され、それ以外のすべては永久に保持されます (「docs/」で始まる)。

+
「docs/」で始まる削除マーカーは、期限が切れると削除されます。

* 「video/movie」という名前のオブジェクトが取り込まれます。フィルターに一致しないため、ILM 保持ポリシーが使用されます。
+
** 50 日後に削除マーカーが作成され、「ビデオ/ムービー」は最新ではなくなります。
** 取り込みから20日、合計70日が経過すると、「ビデオ/ムービー」は削除されます。
** 30 日後、つまり取り込みから合計 100 日と削除マーカーの作成から 50 日が経過すると、期限切れの削除マーカーは削除されます。




--




== バケットライフサイクルを使用して ILM を複製し、期限切れの削除マーカーをクリーンアップする例

ILM ポリシー::
+
--
* 非現在時刻参照に基づくルール: 0日目にX個のコピーを20日間保存する
* 取り込み時間参照に基づくルール（デフォルト）：0日目にX個のコピーを永久に保持する


--
バケットのライフサイクル:: `"Filter": {}, "Expiration": {"ExpiredObjectDeleteMarker": true}, "NoncurrentVersionExpiration": {"NoncurrentDays": 20}`
結果::
+
--
* ILM ポリシーはバケットのライフサイクル内で複製されます。
+
** ILM ポリシーの永久ルールは、オブジェクトを手動で削除し、20 日後に非現在のバージョンをクリーンアップするように設計されています。その結果、取り込み時間ルールは期限切れの削除マーカーを永久に保持することになります。
** バケットのライフサイクルはILMポリシーの動作を複製し、 `"ExpiredObjectDeleteMarker": true`期限が切れると削除マーカーを削除します


* オブジェクトが摂取されます。フィルターがない場合、バケットのライフサイクルはすべてのオブジェクトに適用され、ILM 保持設定が上書きされます。
+
** テナントがオブジェクトの削除要求を発行すると、削除マーカーが作成され、オブジェクトは非最新になります。
** 20 日後、非現在のオブジェクトは削除され、削除マーカーは期限切れになります。
** しばらくすると、期限切れの削除マーカーが削除されます。




--

