---
permalink: ilm/creating-ilm-policy.html 
sidebar: sidebar 
keywords: how to create ILM policy 
summary: サービス品質の要件を満たす 1 つ以上の ILM ポリシーを作成します。 
---
= ILMポリシーを作成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
サービス品質の要件を満たす 1 つ以上の ILM ポリシーを作成します。

アクティブな ILM ポリシーを 1 つ持つと、すべてのテナントとバケットに同じ ILM ルールを適用できます。

複数のアクティブな ILM ポリシーを持つことで、特定のテナントおよびバケットに適切な ILM ルールを適用し、複数のサービス品質要件を満たすことができます。



== ILMポリシーを作成する

.タスク概要
独自のポリシーを作成する前に、link:ilm-policy-overview.html#default-ilm-policy["デフォルトのILMポリシー"]ストレージ要件を満たしていません。


NOTE: テスト システムでは、システム提供のポリシー (ポリシーのコピー 2 つ (1 つのサイト グリッドの場合) またはサイトごとにコピー 1 つ (複数のサイト グリッドの場合)) のみを使用します。  StorageGRID 11.6 以前では、このポリシーのデフォルト ルールは、すべてのサイトが含まれる「すべてのストレージ ノード」ストレージ プールを使用します。  StorageGRIDシステムに複数のサイトがある場合、オブジェクトの 2 つのコピーが同じサイトに配置されることがあります。


NOTE: もしlink:enabling-s3-object-lock-globally.html["グローバル S3 オブジェクトロック設定が有効になりました"]、ILM ポリシーが S3 オブジェクトロックが有効になっているバケットの要件に準拠していることを確認する必要があります。このセクションでは、S3 オブジェクト ロックを有効にする手順に従います。

.開始する前に
* グリッドマネージャにサインインするには、link:../admin/web-browser-requirements.html["サポートされているウェブブラウザ"] 。
* あなたはlink:../admin/admin-group-permissions.html["必要なアクセス権限"]。
* あなたが持っているlink:access-create-ilm-rule-wizard.html["ILMルールを作成した"]S3 オブジェクト ロックが有効かどうかに基づきます。
+
[role="tabbed-block"]
====
.S3 オブジェクトロックが有効になっていません
--
** あなたが持っているlink:what-ilm-rule-is.html["ILMルールを作成した"]ポリシーに追加したいもの。必要に応じて、ポリシーを保存し、追加のルールを作成してから、ポリシーを編集して新しいルールを追加できます。
** あなたが持っているlink:creating-default-ilm-rule.html["デフォルトのILMルールを作成した"]フィルターが含まれていません。


--
.S3 オブジェクトロックが有効
--
** そのlink:enabling-s3-object-lock-globally.html["グローバル S3 オブジェクトロック設定はすでに有効になっています"]StorageGRIDシステム用。
** あなたが持っているlink:what-ilm-rule-is.html["準拠および非準拠のILMルールを作成した"]ポリシーに追加したいもの。必要に応じて、ポリシーを保存し、追加のルールを作成してから、ポリシーを編集して新しいルールを追加できます。
** あなたが持っているlink:creating-default-ilm-rule.html["デフォルトのILMルールを作成した"]準拠しているポリシーの場合。


--
====
* オプションとして、ビデオを視聴しました: https://netapp.hosted.panopto.com/Panopto/Pages/Viewer.aspx?id=e768d4da-da88-413c-bbaa-b1ff00874d10["ビデオ: ILM ポリシーの概要"^]
+
[link=https://netapp.hosted.panopto.com/Panopto/Pages/Viewer.aspx?id=e768d4da-da88-413c-bbaa-b1ff00874d10]
image::../media/video-screenshot-ilm-policies-118.png[ビデオ: ILM ポリシーの概要]



参照link:ilm-policy-overview.html["ILMポリシーを使用する"] 。

.手順
. *ILM* > *ポリシー*を選択します。
+
グローバル S3 オブジェクト ロック設定が有効になっている場合、ILM ポリシー ページに、どの ILM ルールが準拠しているかが表示されます。

. ILM ポリシーを作成する方法を決定します。
+
[role="tabbed-block"]
====
.新しいポリシーを作成する
--
.. *ポリシーの作成*を選択します。


--
.既存のポリシーを複製する
--
.. 開始するポリシーのチェックボックスをオンにして、[*複製*] を選択します。


--
.既存のポリシーを編集する
.. ポリシーが非アクティブな場合は、編集できます。開始する非アクティブなポリシーのチェックボックスをオンにして、[*編集*] を選択します。


====


. *ポリシー名* フィールドに、ポリシーの一意の名前を入力します。
. オプションで、「*変更理由*」フィールドに、新しいポリシーを作成する理由を入力します。
. ポリシーにルールを追加するには、[*ルールの選択*] を選択します。ルール名を選択すると、そのルールの設定が表示されます。
+
--
ポリシーを複製する場合:

** 複製するポリシーで使用されるルールが選択されます。
** 複製するポリシーで、デフォルトのルールではないフィルターのないルールが使用されていた場合は、それらのルールを 1 つを除いてすべて削除するように求めるメッセージが表示されます。
** デフォルト ルールでフィルターが使用されていた場合は、新しいデフォルト ルールを選択するように求められます。
** デフォルトのルールが最後のルールではなかった場合、そのルールを新しいポリシーの最後に移動できます。


--
+
[role="tabbed-block"]
====
.S3 オブジェクトロックが有効になっていません
--
.. ポリシーのデフォルト ルールを 1 つ選択します。新しいデフォルト ルールを作成するには、*ILM ルール ページ* を選択します。
+
デフォルトのルールは、ポリシー内の別のルールに一致しないオブジェクトに適用されます。デフォルトのルールではフィルターを使用できず、常に最後に評価されます。

+

NOTE: 「2 つのコピーを作成」ルールをポリシーのデフォルト ルールとして使用しないでください。  「2 つのコピーを作成」ルールでは、すべてのサイトが含まれる単一のストレージ プール「すべてのストレージ ノード」が使用されます。  StorageGRIDシステムに複数のサイトがある場合、オブジェクトの 2 つのコピーが同じサイトに配置されることがあります。



--
.S3 オブジェクトロックが有効
--
.. ポリシーのデフォルト ルールを 1 つ選択します。新しいデフォルト ルールを作成するには、*ILM ルール ページ* を選択します。
+
ルールのリストには、準拠しており、フィルターを使用していないルールのみが含まれます。

+

NOTE: 「2 つのコピーを作成」ルールをポリシーのデフォルト ルールとして使用しないでください。 「2 つのコピーを作成」ルールでは、すべてのサイトが含まれる単一のストレージ プール「すべてのストレージ ノード」が使用されます。このルールを使用すると、オブジェクトの複数のコピーが同じサイトに配置される場合があります。

.. 非準拠の S3 バケット内のオブジェクトに対して別の「デフォルト」ルールが必要な場合は、[*非準拠の S3 バケットにフィルターのないルールを含める*] を選択し、フィルターを使用しない非準拠ルールを 1 つ選択します。
+
たとえば、S3 オブジェクトロックが有効になっていないバケットにオブジェクトを保存するために、クラウド ストレージ プールを使用する場合があります。

+

NOTE: フィルターを使用しない非準拠ルールは 1 つだけ選択できます。



参照link:example-7-compliant-ilm-policy-for-s3-object-lock.html["例7: S3オブジェクトロックの準拠ILMポリシー"] 。

--
====


. デフォルトのルールの選択が完了したら、[続行] を選択します。
. 「その他のルール」ステップでは、ポリシーに追加するその他のルールを選択します。これらのルールでは、少なくとも 1 つのフィルター (テナント アカウント、バケット名、高度なフィルター、または非現在の参照時間) が使用されます。次に、[選択]を選択します。
+
「ポリシーの作成」ウィンドウに、選択したルールが一覧表示されます。デフォルトのルールは最後にあり、他のルールはその上にあります。

+
S3 オブジェクト ロックが有効になっていて、準拠していない「デフォルト」ルールも選択した場合、そのルールはポリシーの最後から 2 番目のルールとして追加されます。

+

NOTE: いずれかのルールがオブジェクトを永久に保持しない場合は、警告が表示されます。このポリシーを有効にする場合、デフォルト ルールの配置手順が経過したときにStorageGRID がオブジェクトを削除することを確認する必要があります (バケットのライフサイクルによってオブジェクトが長期間保持されない限り)。

. デフォルト以外のルールの行をドラッグして、これらのルールが評価される順序を決定します。
+
デフォルトのルールを移動することはできません。  S3 オブジェクト ロックが有効になっている場合、非準拠の「デフォルト」ルールが選択されていても、それを移動することはできません。

+

NOTE: ILM ルールが正しい順序になっていることを確認する必要があります。ポリシーを有効にすると、新規オブジェクトと既存オブジェクトは、上から順にリストされた順序でルールによって評価されます。

. 必要に応じて、「*ルールを選択*」を選択してルールを追加または削除します。
. 完了したら、[*保存*] を選択します。
. 追加の ILM ポリシーを作成するには、これらの手順を繰り返します。
. <<simulate-ilm-policy,ILMポリシーをシミュレートする>> 。ポリシーをアクティブ化する前に必ずシミュレートして、期待どおりに動作することを確認する必要があります。




== ポリシーをシミュレートする

ポリシーをアクティブ化して本番データに適用する前に、テスト オブジェクトでポリシーをシミュレートします。

.開始する前に
* テストする各オブジェクトの S3 バケット/オブジェクト キーがわかっています。


.手順
. S3クライアントまたはlink:../tenant/use-s3-console.html["S3 コンソール"]、各ルールをテストするために必要なオブジェクトを取り込みます。
. ILM ポリシー ページで、ポリシーのチェックボックスをオンにして、[シミュレート] を選択します。
. *オブジェクト*フィールドにS3を入力します `bucket/object-key`テストオブジェクト用。例：  `bucket-01/filename.png` 。
. S3 のバージョン管理が有効になっている場合は、オプションで *バージョン ID* フィールドにオブジェクトのバージョン ID を入力します。
. *シミュレート*を選択します。
. シミュレーション結果セクションで、各オブジェクトが正しいルールと一致していることを確認します。
. 有効になっているストレージ プールまたは消去コーディング プロファイルを確認するには、一致したルールの名前を選択して、ルールの詳細ページに移動します。



CAUTION: 既存の複製および消去コード化されたオブジェクトの配置の変更を確認します。既存のオブジェクトの場所を変更すると、新しい配置が評価され実装されるときに一時的なリソースの問題が発生する可能性があります。

.結果
ポリシーのルールを編集すると、シミュレーション結果に反映され、新しい一致と以前の一致が表示されます。  「シミュレートポリシー」ウィンドウには、*すべてクリア*または削除アイコンを選択するまで、テストしたオブジェクトが保持されます。image:../media/icon-x-to-remove.png["アイコンを削除"]シミュレーション結果リスト内の各オブジェクトに対して。

.関連情報
link:simulating-ilm-policy-examples.html["ILMポリシーシミュレーションの例"]



== ポリシーを有効にする

単一の新しい ILM ポリシーをアクティブ化すると、既存のオブジェクトと新しく取り込まれたオブジェクトがそのポリシーによって管理されます。複数のポリシーをアクティブ化すると、バケットに割り当てられた ILM ポリシー タグによって管理対象のオブジェクトが決まります。

新しいポリシーを有効にする前に:

. ポリシーをシミュレートして、期待どおりに動作することを確認します。
. 既存の複製および消去コード化されたオブジェクトの配置の変更を確認します。既存のオブジェクトの場所を変更すると、新しい配置が評価され実装されるときに一時的なリソースの問題が発生する可能性があります。



CAUTION: ILM ポリシーにエラーがあると、回復不能なデータ損失が発生する可能性があります。

.タスク概要
ILM ポリシーをアクティブ化すると、システムは新しいポリシーをすべてのノードに配布します。ただし、すべてのグリッド ノードが新しいポリシーを受信できるようになるまで、新しいアクティブ ポリシーは実際には有効にならない可能性があります。場合によっては、グリッド オブジェクトが誤って削除されないようにするために、システムは新しいアクティブ ポリシーの実装を待機します。具体的な制限事項は次のとおりです。

* *データの冗長性または耐久性を高める*ポリシー変更を行った場合、その変更は直ちに実装されます。たとえば、2 つのコピー ルールではなく 3 つのコピー ルールを含む新しいポリシーを有効にすると、データの冗長性が向上するため、そのポリシーはすぐに実装されます。
* *データの冗長性または耐久性を低下させる可能性がある*ポリシー変更を行った場合、その変更はすべてのグリッド ノードが利用可能になるまで実装されません。たとえば、3 つのコピー ルールではなく 2 つのコピー ルールを使用する新しいポリシーをアクティブ化すると、新しいポリシーは [アクティブ ポリシー] タブに表示されますが、すべてのノードがオンラインで使用可能になるまで有効になりません。


.手順
1 つまたは複数のポリシーをアクティブ化する手順は次のとおりです。

[role="tabbed-block"]
====
.1つのポリシーを有効にする
--
アクティブなポリシーが 1 つだけの場合は、次の手順に従ってください。すでに 1 つ以上のアクティブなポリシーがあり、追加のポリシーをアクティブ化する場合は、複数のポリシーをアクティブ化する手順に従います。

. ポリシーを有効にする準備ができたら、*ILM* > *ポリシー* を選択します。
+
または、*ILM* > *ポリシー タグ* ページから単一のポリシーをアクティブ化することもできます。

. [ポリシー] タブで、アクティブ化するポリシーのチェックボックスをオンにして、[アクティブ化] を選択します。
. 適切な手順に従ってください。
+
** ポリシーを有効にするかどうかを確認する警告メッセージが表示されたら、[*OK*] を選択します。
** ポリシーの詳細を含む警告メッセージが表示された場合:
+
... 詳細を確認して、ポリシーが期待どおりにデータを管理することを確認します。
... デフォルトのルールでオブジェクトが限られた日数だけ保存される場合は、保持図を確認して、その日数をテキスト ボックスに入力します。
... デフォルトのルールではオブジェクトが永久に保存されるが、他の 1 つ以上のルールでは保存期間が制限されている場合は、テキスト ボックスに「*yes*」と入力します。
... *ポリシーの有効化*を選択します。






--
.複数のポリシーを有効にする
--
複数のポリシーを有効にするには、タグを作成し、各タグにポリシーを割り当てる必要があります。


TIP: 複数のタグが使用されている場合、テナントがバケットにポリシー タグを頻繁に再割り当てすると、グリッドのパフォーマンスに影響が出る可能性があります。信頼できないテナントがある場合は、デフォルト タグのみを使用することを検討してください。

. *ILM* > *ポリシー タグ* を選択します。
. *作成*を選択します。
. [ポリシー タグの作成] ダイアログ ボックスで、タグ名を入力し、必要に応じてタグの説明を入力します。
+

NOTE: タグ名と説明はテナントに表示されます。バケットに割り当てるポリシー タグを選択する際に、テナントが十分な情報に基づいた決定を下せるようにする値を選択します。たとえば、割り当てられたポリシーによって一定期間後にオブジェクトが削除される場合は、説明でその旨を伝えることができます。これらのフィールドには機密情報を含めないでください。

. *タグを作成*を選択します。
. ILM ポリシー タグ テーブルで、プルダウンを使用してタグに割り当てるポリシーを選択します。
. 「ポリシーの制限」列に警告が表示された場合は、「*ポリシーの詳細を表示*」を選択してポリシーを確認してください。
. 各ポリシーが期待どおりにデータを管理することを確認します。
. *割り当てられたポリシーをアクティブ化する*を選択します。または、[*変更をクリア*] を選択してポリシーの割り当てを削除します。
. [新しいタグを使用してポリシーをアクティブ化する] ダイアログ ボックスで、各タグ、ポリシー、ルールがオブジェクトを管理する方法の説明を確認します。必要に応じて変更を加え、ポリシーが期待どおりにオブジェクトを管理するようにします。
. ポリシーをアクティブ化することに確信がある場合は、テキスト ボックスに「*はい*」と入力し、「*ポリシーのアクティブ化*」を選択します。


--
====
.関連情報
link:example-6-changing-ilm-policy.html["例6: ILMポリシーの変更"]
